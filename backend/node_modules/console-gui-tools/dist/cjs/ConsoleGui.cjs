/* eslint-disable linebreak-style */
/*                                                                            
   ____                      _         ____       _   _____           _       
  / ___|___  _ __  ___  ___ | | ___   / ___|_   _(_) |_   _|__   ___ | |___   
 | |   / _ \| '_ \/ __|/ _ \| |/ _ \ | |  _| | | | |   | |/ _ \ / _ \| / __|  
 | |__| (_) | | | \__ \ (_) | |  __/ | |_| | |_| | |   | | (_) | (_) | \__ \  
  \____\___/|_| |_|___/\___/|_|\___|  \____|\__,_|_|   |_|\___/ \___/|_|___/  
                                                                              
                                                                      v3.2.2 


   A simple library to draw option menu, text popup or other widgets and layout on a Node.js console.                                                          

   Author: Elia Lazzari
   License: MIT
   Repository: git+https://github.com/Elius94/console-gui-tools.git

   This program is free software: you can redistribute it and/or modify

   Build: Tue, 26 Sep 2023 07:25:28 GMT for Node node18.18, ECMAScript es2022
*/

"use strict";var re=Object.create;var j=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var he=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var ue=(a,o)=>{for(var t in o)j(a,t,{get:o[t],enumerable:!0})},Mt=(a,o,t,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of le(o))!ae.call(a,i)&&i!==t&&j(a,i,{get:()=>o[i],enumerable:!(e=ne(o,i))||e.enumerable});return a};var _=(a,o,t)=>(t=a!=null?re(he(a)):{},Mt(o||!a||!a.__esModule?j(t,"default",{value:a,enumerable:!0}):t,a)),de=a=>Mt(j({},"__esModule",{value:!0}),a);var Me={};ue(Me,{Box:()=>et,Button:()=>it,ButtonPopup:()=>G,ConfirmPopup:()=>J,ConsoleManager:()=>y,Control:()=>K,CustomPopup:()=>H,EOL:()=>f.EOL,FileSelectorPopup:()=>Q,InPageWidgetBuilder:()=>I,InputPopup:()=>Z,OptionPopup:()=>tt,PageBuilder:()=>T,Progress:()=>st});module.exports=de(Me);var Zt=require("events"),te=_(require("readline"),1);var r={normal:{topLeft:"\u250C",topRight:"\u2510",bottomLeft:"\u2514",bottomRight:"\u2518",horizontal:"\u2500",vertical:"\u2502",cross:"\u253C",left:"\u251C",right:"\u2524",top:"\u252C",bottom:"\u2534",start:"",end:"",color:""},selected:{topLeft:"\u2554",topRight:"\u2557",bottomLeft:"\u255A",bottomRight:"\u255D",horizontal:"\u2550",vertical:"\u2551",cross:"\u256C",left:"\u2560",right:"\u2563",top:"\u2566",bottom:"\u2569",start:"",end:"",color:""},hovered:{topLeft:"\u2553",topRight:"\u2556",bottomLeft:"\u2559",bottomRight:"\u255C",horizontal:"\u2500",vertical:"\u2502",cross:"\u256B",left:"\u255F",right:"\u2562",top:"\u2565",bottom:"\u2568",start:"",end:"",color:""}};function x(a,o,t){if(g(a)<=o)return a;let e=a.substring(0,o-1);return(t?e.substring(0,e.lastIndexOf(" ")):e)+"\u2026"}function Et(a){return{text:a.text,color:a.style?.color,bg:a.style?.bg,italic:a.style?.italic,bold:a.style?.bold,dim:a.style?.dim,underline:a.style?.underline,inverse:a.style?.inverse,hidden:a.style?.hidden,strikethrough:a.style?.strikethrough,overline:a.style?.overline}}function Tt(a){return{text:a.text,style:{color:a?.color,bg:a?.bg,italic:a?.italic,bold:a?.bold,dim:a?.dim,underline:a?.underline,inverse:a?.inverse,hidden:a?.hidden,strikethrough:a?.strikethrough,overline:a?.overline}}}function g(a){let o=new RegExp("[\x1B\x9B][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]","g");return Array.from(a.replace(o,"")).length}var lt=class{constructor(o=100){this.rowsPerPage=o,this.scrollIndex=0,this.content=[]}addRow(...o){let t=o.map(e=>Tt(e));return this.content.push(t),this}addSpacer(o=1){if(o>0)for(let t=0;t<o;t++)this.addRow({text:"",color:""});return this}getContent(){return this.getPageHeight()>this.rowsPerPage?this.content.slice(this.getPageHeight()-this.scrollIndex-this.rowsPerPage,this.getPageHeight()-this.scrollIndex):this.content}getPageHeight(){return this.content.length}getViewedPageHeight(){return this.getContent().length}setScrollIndex(o){return this.scrollIndex=o,this}setRowsPerPage(o){return this.rowsPerPage=o,this}increaseScrollIndex(){return this.scrollIndex<this.getPageHeight()-this.rowsPerPage&&this.scrollIndex++,this}decreaseScrollIndex(){return this.scrollIndex>0&&this.scrollIndex--,this}clear(){return this.content=[],this}},T=lt;var ht=class extends T{constructor(o=100){super(o)}},I=ht;var zt=require("events");var Lt=(a=0)=>o=>`\x1B[${o+a}m`,Ot=(a=0)=>o=>`\x1B[${38+a};5;${o}m`,Pt=(a=0)=>(o,t,e)=>`\x1B[${38+a};2;${o};${t};${e}m`,w={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},$t=Object.keys(w.modifier),at=Object.keys(w.color),ut=Object.keys(w.bgColor),Bt=[...at,...ut];function ce(){let a=new Map;for(let[o,t]of Object.entries(w)){for(let[e,i]of Object.entries(t))w[e]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},t[e]=w[e],a.set(i[0],i[1]);Object.defineProperty(w,o,{value:t,enumerable:!1})}return Object.defineProperty(w,"codes",{value:a,enumerable:!1}),w.color.close="\x1B[39m",w.bgColor.close="\x1B[49m",w.color.ansi=Lt(),w.color.ansi256=Ot(),w.color.ansi16m=Pt(),w.bgColor.ansi=Lt(10),w.bgColor.ansi256=Ot(10),w.bgColor.ansi16m=Pt(10),Object.defineProperties(w,{rgbToAnsi256:{value(o,t,e){return o===t&&t===e?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(t/255*5)+Math.round(e/255*5)},enumerable:!1},hexToRgb:{value(o){let t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(o.toString(16));if(!t)return[0,0,0];let[e]=t;e.length===3&&(e=[...e].map(s=>s+s).join(""));let i=Number.parseInt(e,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:o=>w.rgbToAnsi256(...w.hexToRgb(o)),enumerable:!1},ansi256ToAnsi:{value(o){if(o<8)return 30+o;if(o<16)return 90+(o-8);let t,e,i;if(o>=232)t=((o-232)*10+8)/255,e=t,i=t;else{o-=16;let l=o%36;t=Math.floor(o/36)/5,e=Math.floor(l/6)/5,i=l%6/5}let s=Math.max(t,e,i)*2;if(s===0)return 30;let n=30+(Math.round(i)<<2|Math.round(e)<<1|Math.round(t));return s===2&&(n+=60),n},enumerable:!1},rgbToAnsi:{value:(o,t,e)=>w.ansi256ToAnsi(w.rgbToAnsi256(o,t,e)),enumerable:!1},hexToAnsi:{value:o=>w.ansi256ToAnsi(w.hexToAnsi256(o)),enumerable:!1}}),w}var pe=ce(),R=pe;var Y=_(require("process"),1),kt=_(require("os"),1),dt=_(require("tty"),1);function $(a,o=globalThis.Deno?globalThis.Deno.args:Y.default.argv){let t=a.startsWith("-")?"":a.length===1?"-":"--",e=o.indexOf(t+a),i=o.indexOf("--");return e!==-1&&(i===-1||e<i)}var{env:v}=Y.default,X;$("no-color")||$("no-colors")||$("color=false")||$("color=never")?X=0:($("color")||$("colors")||$("color=true")||$("color=always"))&&(X=1);function ge(){if("FORCE_COLOR"in v)return v.FORCE_COLOR==="true"?1:v.FORCE_COLOR==="false"?0:v.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(v.FORCE_COLOR,10),3)}function fe(a){return a===0?!1:{level:a,hasBasic:!0,has256:a>=2,has16m:a>=3}}function be(a,{streamIsTTY:o,sniffFlags:t=!0}={}){let e=ge();e!==void 0&&(X=e);let i=t?X:e;if(i===0)return 0;if(t){if($("color=16m")||$("color=full")||$("color=truecolor"))return 3;if($("color=256"))return 2}if("TF_BUILD"in v&&"AGENT_NAME"in v)return 1;if(a&&!o&&i===void 0)return 0;let s=i||0;if(v.TERM==="dumb")return s;if(Y.default.platform==="win32"){let n=kt.default.release().split(".");return Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in v)return"GITHUB_ACTIONS"in v?3:["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some(n=>n in v)||v.CI_NAME==="codeship"?1:s;if("TEAMCITY_VERSION"in v)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(v.TEAMCITY_VERSION)?1:0;if(v.COLORTERM==="truecolor"||v.TERM==="xterm-kitty")return 3;if("TERM_PROGRAM"in v){let n=Number.parseInt((v.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(v.TERM_PROGRAM){case"iTerm.app":return n>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(v.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(v.TERM)||"COLORTERM"in v?1:s}function Rt(a,o={}){let t=be(a,{streamIsTTY:a&&a.isTTY,...o});return fe(t)}var me={stdout:Rt({isTTY:dt.default.isatty(1)}),stderr:Rt({isTTY:dt.default.isatty(2)})},It=me;function Vt(a,o,t){let e=a.indexOf(o);if(e===-1)return a;let i=o.length,s=0,n="";do n+=a.slice(s,e)+o+t,s=e+i,e=a.indexOf(o,s);while(e!==-1);return n+=a.slice(s),n}function Nt(a,o,t,e){let i=0,s="";do{let n=a[e-1]==="\r";s+=a.slice(i,n?e-1:e)+o+(n?`\r
`:`
`)+t,i=e+1,e=a.indexOf(`
`,i)}while(e!==-1);return s+=a.slice(i),s}var{stdout:Ft,stderr:_t}=It,ct=Symbol("GENERATOR"),A=Symbol("STYLER"),D=Symbol("IS_EMPTY"),At=["ansi","ansi","ansi256","ansi16m"],z=Object.create(null),xe=(a,o={})=>{if(o.level&&!(Number.isInteger(o.level)&&o.level>=0&&o.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let t=Ft?Ft.level:0;a.level=o.level===void 0?t:o.level};var ye=a=>{let o=(...t)=>t.join(" ");return xe(o,a),Object.setPrototypeOf(o,U.prototype),o};function U(a){return ye(a)}Object.setPrototypeOf(U.prototype,Function.prototype);for(let[a,o]of Object.entries(R))z[a]={get(){let t=q(this,gt(o.open,o.close,this[A]),this[D]);return Object.defineProperty(this,a,{value:t}),t}};z.visible={get(){let a=q(this,this[A],!0);return Object.defineProperty(this,"visible",{value:a}),a}};var pt=(a,o,t,...e)=>a==="rgb"?o==="ansi16m"?R[t].ansi16m(...e):o==="ansi256"?R[t].ansi256(R.rgbToAnsi256(...e)):R[t].ansi(R.rgbToAnsi(...e)):a==="hex"?pt("rgb",o,t,...R.hexToRgb(...e)):R[t][a](...e),Ce=["rgb","hex","ansi256"];for(let a of Ce){z[a]={get(){let{level:t}=this;return function(...e){let i=gt(pt(a,At[t],"color",...e),R.color.close,this[A]);return q(this,i,this[D])}}};let o="bg"+a[0].toUpperCase()+a.slice(1);z[o]={get(){let{level:t}=this;return function(...e){let i=gt(pt(a,At[t],"bgColor",...e),R.bgColor.close,this[A]);return q(this,i,this[D])}}}}var Se=Object.defineProperties(()=>{},{...z,level:{enumerable:!0,get(){return this[ct].level},set(a){this[ct].level=a}}}),gt=(a,o,t)=>{let e,i;return t===void 0?(e=a,i=o):(e=t.openAll+a,i=o+t.closeAll),{open:a,close:o,openAll:e,closeAll:i,parent:t}},q=(a,o,t)=>{let e=(...i)=>we(e,i.length===1?""+i[0]:i.join(" "));return Object.setPrototypeOf(e,Se),e[ct]=a,e[A]=o,e[D]=t,e},we=(a,o)=>{if(a.level<=0||!o)return a[D]?"":o;let t=a[A];if(t===void 0)return o;let{openAll:e,closeAll:i}=t;if(o.includes("\x1B"))for(;t!==void 0;)o=Vt(o,t.close,t.open),t=t.parent;let s=o.indexOf(`
`);return s!==-1&&(o=Nt(o,i,e,s)),e+o+i};Object.defineProperties(U.prototype,z);var ve=U(),We=U({level:_t?_t.level:0});var E=ve;E.level=3;var ft=class extends zt.EventEmitter{constructor(t){super();this.currentY=0;this.Terminal=t,this.width=this.Terminal.columns,this.height=this.Terminal.rows,this.buffer=[],this.cursor={x:0,y:0},this.Terminal.on("resize",()=>{this.emit("resize")})}write(...t){if(this.currentY++,this.cursor.y<this.buffer.length){let e="",i=[];for(let l=0;l<t.length;l++){let h=t[l];if(h.text!==void 0){let u=h.text.toString(),d={...h.style,index:[g(e),g(e)+g(u)]};i.push(d),e+=u}}let s=this.buffer[this.cursor.y].styleIndex,n=this.mergeStyles(i,s,this.cursor.x,g(e));this.buffer[this.cursor.y].styleIndex=n,this.buffer[this.cursor.y].text=this.replaceAt(this.buffer[this.cursor.y].text,this.cursor.x,e),this.cursorTo(0,this.cursor.y+1)}}cursorTo(t,e){this.cursor.x=t,this.cursor.y=e}moveCursor(t,e){this.Terminal.cursorTo(t,e)}update(){this.cursorTo(0,0),this.width=this.Terminal.columns,this.height=this.Terminal.rows,this.buffer=[];for(let t=0;t<this.Terminal.rows;t++)this.buffer[t]={text:" ".repeat(this.Terminal.columns),styleIndex:[{color:"gray",bg:"",italic:!1,bold:!1,index:[0,this.Terminal.columns]}]}}print(){this.buffer.forEach((t,e)=>{this.Terminal.cursorTo(0,e);let i="";t.styleIndex.forEach(s=>{let n=b=>b;if(s.color)if(s.color[0]==="#")n=E.hex(s.color);else if(s.color.includes("rgb")){let b=[...s.color.matchAll(/\d+/g)].map(P=>P[0]);n=E.rgb(Number(b[0]),Number(b[1]),Number(b[2]))}else n=E[s.color];let l=b=>b;if(s.bg)if(s.bg[0]==="#")l=E.bgHex(s.bg);else if(s.bg.includes("rgb")){let b=[...s.bg.matchAll(/\d+/g)].map(P=>P[0]);l=E.bgRgb(Number(b[0]),Number(b[1]),Number(b[2]))}else l=E[s.bg];let h=s.italic?E.italic:b=>b,u=s.bold?E.bold:b=>b,d=s.dim?E.dim:b=>b,c=s.underline?E.underline:b=>b,p=s.overline?E.overline:b=>b,C=s.inverse?E.inverse:b=>b,M=s.hidden?E.hidden:b=>b,B=s.strikethrough?E.strikethrough:b=>b;i+=n(l(h(u(d(c(p(C(M(B(t.text.substring(s.index[0],s.index[1])))))))))))}),this.Terminal.write(i)}),this.Terminal.clearScreenDown()}replaceAt(t,e,i){return t.substring(0,e)+i+t.substring(e+i.length)}mergeStyles(t,e,i,s){let n=[...t],l=[...e],h=i,u=s,d=[];return l.forEach(c=>{if(c.index[0]<h&&c.index[1]<h){d.push(c);return}else if(c.index[0]<h&&c.index[1]>=h&&c.index[1]<=h+u){d.push({...c,index:[c.index[0],h]});return}else if(c.index[0]<h&&c.index[1]>h+u){d.push({...c,index:[c.index[0],h]}),d.push({...c,index:[h+u,c.index[1]]});return}else{if(c.index[0]>=h&&c.index[1]<=h+u)return;if(c.index[0]>=h&&c.index[0]<=h+u&&c.index[1]>h+u){d.push({...c,index:[h+u,c.index[1]]});return}else if(c.index[0]>h+u&&c.index[1]>h+u){d.push(c);return}}this.emit("error",new Error("mergeStyles: This should never happen"))}),n.forEach(c=>{d.push({...c,index:[c.index[0]+h,c.index[1]+h]})}),d.sort(this.sortByIndex),d}sortByIndex(t,e){return t.index[0]<e.index[0]?-1:t.index[0]>e.index[0]?1:0}},Wt=ft;var Dt=require("events");var H=class extends Dt.EventEmitter{constructor(t){if(!t)throw new Error("PopupConfig is required");let{id:e,title:i,content:s,width:n,visible:l=!1}=t;if(!e)throw new Error("id is required");if(!i)throw new Error("title is required");if(!s)throw new Error("content is required");if(!n)throw new Error("width is required");super();this.parsingMouseFrame=!1;this.dragging=!1;this.dragStart={x:0,y:0};this.focused=!1;this.mouseListener=t=>{let e=t.data.x,i=t.data.y;if(e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+this.absoluteValues.height?t.name==="MOUSE_WHEEL_DOWN"?(this.content.increaseScrollIndex(),this.focused=!0):t.name==="MOUSE_WHEEL_UP"?(this.content.decreaseScrollIndex(),this.focused=!0):t.name==="MOUSE_LEFT_BUTTON_PRESSED"&&(this.focused=!0):this.focused=!1,t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!1&&this.focused)e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+3&&(this.dragging=!0,this.dragStart={x:e,y:i});else if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!0){if(i-this.dragStart.y+this.absoluteValues.y<0||e-this.dragStart.x+this.absoluteValues.x<0)return;this.offsetX+=e-this.dragStart.x,this.offsetY+=i-this.dragStart.y,this.dragStart={x:e,y:i},this.CM.refresh()}else t.name==="MOUSE_LEFT_BUTTON_RELEASED"&&this.dragging===!0&&(this.dragging=!1,this.CM.refresh())};if(this.CM=new y,this.id=e,this.title=i,this.content=s,this.width=n,this.visible=l,this.marginTop=4,this.offsetX=0,this.offsetY=0,this.absoluteValues={x:0,y:0,width:0,height:0},this.CM.popupCollection[this.id]){this.CM.unregisterPopup(this);let h=`CustomPopup ${this.id} already exists.`;throw this.CM.error(h),new Error(h)}this.CM.registerPopup(this)}keyListener(t,e){let i=this.CM.mouse.isMouseFrame(e,this.parsingMouseFrame);if(i===1){this.parsingMouseFrame=!0;return}else if(i===-1){this.parsingMouseFrame=!1;return}switch(e.name){case"up":this.content.increaseScrollIndex();break;case"down":this.content.decreaseScrollIndex();break;case"return":this.emit("confirm"),this.CM.unregisterPopup(this),this.hide();break;case"escape":this.emit("cancel"),this.CM.unregisterPopup(this),this.hide();break;case"q":this.CM.emit("exit"),this.CM.unregisterPopup(this),this.hide();break;default:break}this.CM.refresh()}getContent(){return this.content}setContent(t){return this.content=t,this.CM.refresh(),this}setWidth(t){return this.width=t,this.CM.refresh(),this}show(){return this.visible||(this.manageInput(),this.visible=!0,this.CM.refresh(),this.CM.unfocusOtherWidgets(this.id)),this}hide(){return this.visible&&(this.unManageInput(),this.visible=!1,this.CM.restoreFocusInWidgets(),this.CM.refresh()),this}isVisible(){return this.visible}getPosition(){return this.absoluteValues}manageInput(){return this.CM.setKeyListener(this.id,this.keyListener.bind(this)),this.CM.mouse&&this.CM.setMouseListener(`${this.id}_mouse`,this.mouseListener.bind(this)),this}unManageInput(){return this.CM.removeKeyListener(this.id),this.CM.mouse&&this.CM.removeMouseListener(`${this.id}_mouse`),this}drawLine(t,e){let i="",s=[...t];if(t.forEach(n=>{i+=n.text}),g(i)>e-2){s=JSON.parse(JSON.stringify(t));let l=g(i)-e;for(let h=s.length-1;h>=0;h--)if(g(s[h].text)>l+2){s[h].text=x(s[h].text,g(s[h].text)-l-2,!0);break}else l-=g(s[h].text),s.splice(h,1);i="",s.forEach(h=>{i+=h.text})}s.unshift({text:r.normal.vertical,style:{color:"white"}}),g(i)<=e&&s.push({text:`${" ".repeat(e-g(i))}`,style:{color:""}}),s.push({text:r.normal.vertical,style:{color:"white"}}),this.CM.Screen.write(...s)}draw(){let e=this.title.length>this.width?this.title.length+4:this.width+4+1,i=Math.round((e-this.title.length)/2),s=Math.round(this.CM.Screen.width/2-e/2),n=r.normal.topLeft;for(let c=0;c<e;c++)n+=r.normal.horizontal;n+=`${r.normal.topRight}${f.EOL}`,n+=`${r.normal.vertical}${" ".repeat(i)}${this.title}${" ".repeat(e-i-this.title.length)}${r.normal.vertical}${f.EOL}`,n+=`${r.normal.left}${r.normal.horizontal.repeat(e)}${r.normal.right}${f.EOL}`;let h=`${n}`.split(f.EOL),u=Math.round(this.CM.Screen.width/2-e/2);h.forEach((c,p)=>{this.CM.Screen.cursorTo(s+this.offsetX,this.marginTop+p+this.offsetY),this.CM.Screen.write({text:c,style:{color:"white"}})});let d=this.content.getContent();return d.forEach((c,p)=>{this.CM.Screen.cursorTo(s+this.offsetX,this.marginTop+p+h.length-1+this.offsetY),this.drawLine(c,e)}),this.CM.Screen.cursorTo(s+this.offsetX,this.marginTop+d.length+h.length-1+this.offsetY),this.CM.Screen.write({text:`${r.normal.bottomLeft}${r.normal.horizontal.repeat(e)}${r.normal.bottomRight}`,style:{color:"white"}}),this.absoluteValues={x:u+this.offsetX,y:this.marginTop+this.offsetY,width:e,height:h.length},this}};var Ut=require("events");var G=class extends Ut.EventEmitter{constructor(t){if(!t)throw new Error("The config is required");let{id:e,title:i,message:s,buttons:n=["Ok","Cancel","?"],visible:l=!1}=t;if(!e)throw new Error("The id is required");if(!i)throw new Error("The title is required");super();this.parsingMouseFrame=!1;this.buttonsAbsoluteValues=[];this.dragging=!1;this.dragStart={x:0,y:0};this.focused=!1;this.mouseListener=t=>{let e=t.data.x,i=t.data.y;if(e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+this.absoluteValues.height){if(t.name==="MOUSE_LEFT_BUTTON_PRESSED"){for(let s=0;s<this.buttonsAbsoluteValues.length;s++){let n=this.buttonsAbsoluteValues[s];if(e>n.x&&e<n.x+n.width&&i>n.y&&i<n.y+n.height){this.selected=s,this.CM.refresh();break}}this.focused=!0;return}if(t.name==="MOUSE_LEFT_BUTTON_RELEASED"){this.focused&&(this.buttons&&this.buttons.length===2&&this.buttons[0].toLowerCase()==="yes"&&this.buttons[1].toLowerCase()==="no"?this.selected===0?this.emit("confirm"):this.emit("cancel"):this.emit("confirm",this.buttons[this.selected]),this.CM.unregisterPopup(this),this.hide());return}if(t.name==="MOUSE_MOTION")for(let s=0;s<this.buttonsAbsoluteValues.length;s++){let n=this.buttonsAbsoluteValues[s];if(e>n.x&&e<n.x+n.width&&i>n.y&&i<n.y+n.height){this.hovered=s,this.CM.refresh();break}}}else this.focused=!1;if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!1&&this.focused)e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+3&&(this.dragging=!0,this.dragStart={x:e,y:i});else if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!0){if(i-this.dragStart.y+this.absoluteValues.y<0||e-this.dragStart.x+this.absoluteValues.x<0)return;this.offsetX+=e-this.dragStart.x,this.offsetY+=i-this.dragStart.y,this.dragStart={x:e,y:i},this.CM.refresh()}else t.name==="MOUSE_LEFT_BUTTON_RELEASED"&&this.dragging===!0&&(this.dragging=!1,this.CM.refresh())};if(this.CM=new y,this.id=e,this.title=i,this.message=s||"",this.buttons=n,this.selected=0,this.hovered=-1,this.visible=l,this.marginTop=4,this.offsetX=0,this.offsetY=0,this.absoluteValues={x:0,y:0,width:0,height:0},this.CM.popupCollection[this.id]){this.CM.unregisterPopup(this);let h=`ButtonPopup ${this.id} already exists.`;throw this.CM.error(h),new Error(h)}this.CM.registerPopup(this)}keyListener(t,e){let i=this.CM.mouse.isMouseFrame(e,this.parsingMouseFrame);if(i===1){this.parsingMouseFrame=!0;return}else if(i===-1){this.parsingMouseFrame=!1;return}switch(e.name){case"left":if(this.selected>0&&this.selected<=this.buttons.length)this.selected--;else return;break;case"right":if(this.selected>=0&&this.selected<this.buttons.length-1)this.selected++;else return;break;case"return":this.emit("confirm",this.buttons[this.selected]),this.CM.unregisterPopup(this),this.hide();break;case"escape":this.emit("cancel"),this.CM.unregisterPopup(this),this.hide();break;case"q":this.CM.emit("exit"),this.CM.unregisterPopup(this),this.hide();break;default:break}this.CM.refresh()}show(){return this.visible||(this.manageInput(),this.visible=!0,this.CM.refresh(),this.CM.unfocusOtherWidgets(this.id)),this}hide(){return this.visible&&(this.unManageInput(),this.visible=!1,this.CM.restoreFocusInWidgets(),this.CM.refresh()),this}isVisible(){return this.visible}getPosition(){return this.absoluteValues}manageInput(){return this.CM.setKeyListener(this.id,this.keyListener.bind(this)),this.CM.mouse&&this.CM.setMouseListener(`${this.id}_mouse`,this.mouseListener.bind(this)),this}unManageInput(){return this.CM.removeKeyListener(this.id),this.CM.mouse&&this.CM.removeMouseListener(`${this.id}_mouse`),this}draw(){let s=0,n=[],l=0,h=0;this.buttons.forEach(m=>{let L=m.length+4+1;l+L>this.CM.Screen.width-2*1?(h++,n[h]?n[h].push(m):n[h]=[m],l=L,l>s&&(s=l-1)):(n[h]?n[h].push(m):n[h]=[m],l+=L,l>s&&(s=l-1))});let u=`${this.title}`;u.length>this.CM.Screen.width-2*1&&(u=x(u,this.CM.Screen.width-2*1,!0));let d=u.length+2*1,p=(this.message?`${this.message}`:"").split(f.EOL);p.length>0&&(p=p.map(m=>m.length>this.CM.Screen.width-2*1?x(m,this.CM.Screen.width-2*1,!0):m)),p.forEach(m=>{m.length>d&&(d=m.length)}),d<s&&(d=s+2*1);let C=Math.round((d-u.length)/2),M=p.map(m=>Math.round((d-m.length)/2)),B=r.normal.topLeft;for(let m=0;m<d;m++)B+=r.normal.horizontal;B+=`${r.normal.topRight}${f.EOL}`,B+=`${r.normal.vertical}${" ".repeat(C)}${u}${" ".repeat(d-C-u.length)}${r.normal.vertical}${f.EOL}`,B+=`${r.normal.left}${r.normal.horizontal.repeat(d)}${r.normal.right}${f.EOL}`;let b=r.normal.bottomLeft;for(let m=0;m<d;m++)b+=r.normal.horizontal;b+=`${r.normal.bottomRight}${f.EOL}`;let P="";p.length>0&&p[0].length>0&&p.forEach((m,L)=>{P+=`${r.normal.vertical}${" ".repeat(M[L])}${m}${" ".repeat(d-M[L]-m.length)}${r.normal.vertical}${f.EOL}`});let ee=p.length+3;this.buttonsAbsoluteValues=[];let rt=Math.round(this.CM.Screen.width/2-d/2);n.forEach(m=>{for(let L=0;L<3;L++){let nt=m.map(O=>O.length+4+1),vt=nt.reduce((O,N)=>O+N,0)-1,V=d-vt>=0?d-vt:0;m.forEach((O,N)=>{let k;k=this.selected===this.buttons.indexOf(O)?"selected":"normal",this.hovered===this.buttons.indexOf(O)&&this.selected!==this.buttons.indexOf(O)&&(k="hovered"),N<m.length?(N===0&&(P+=`${r.normal.vertical}${" ".repeat(V/2)}`),L===0?P+=`${r[k].topLeft}${r[k].horizontal.repeat(2>1?2*(2-1)+O.length:O.length)}${r[k].topRight}`:L===1?P+=`${r[k].vertical}${2>1?" ".repeat(2-1):""}${O}${2>1?" ".repeat(2-1):""}${r[k].vertical}`:L===2?P+=`${r[k].bottomLeft}${r[k].horizontal.repeat(2>1?2*(2-1)+O.length:O.length)}${r[k].bottomRight}`:this.CM.error("Error in ButtonPopup draw function"),N===m.length-1?P+=" ".repeat(V%2?Math.round(V/2):V/2)+`${r.normal.vertical}${f.EOL}`:P+=" ".repeat(1)):N===m.length&&(P+=" ".repeat(V%2?Math.round(V/2):V/2)+`${r.normal.vertical}${f.EOL}`);let ie={id:this.buttons.indexOf(O),x:rt+this.offsetX+V/2+nt.slice(0,N).reduce((se,oe)=>se+oe,0)+1,y:this.marginTop+this.offsetY-(h+1)/2+this.buttons.indexOf(O)+ee,width:nt[N]-1+1,height:3};this.buttonsAbsoluteValues.push(ie)})}});let wt=`${B}${P}${b}`.split(f.EOL);return wt.forEach((m,L)=>{this.CM.Screen.cursorTo(rt+this.offsetX,this.marginTop+L+this.offsetY),this.CM.Screen.write({text:m,style:{color:"white"}})}),this.absoluteValues={x:rt+this.offsetX,y:this.marginTop+this.offsetY,width:d,height:wt.length},this}},Ht=G;var J=class extends Ht{constructor(o){if(!o)throw new Error("The config is not defined");let{id:t,title:e,message:i}=o;super({id:t,title:e,message:i,buttons:["Yes","No"],visible:!1}),super.keyListener=(s,n)=>{let l=this.CM.mouse.isMouseFrame(n,this.parsingMouseFrame);if(l===1){this.parsingMouseFrame=!0;return}else if(l===-1){this.parsingMouseFrame=!1;return}switch(n.name){case"left":if(this.selected>0&&this.selected<=this.buttons.length)this.selected--;else return;break;case"right":if(this.selected>=0&&this.selected<this.buttons.length-1)this.selected++;else return;break;case"return":this.selected===0?this.emit("confirm"):this.emit("cancel"),this.CM.unregisterPopup(this),this.hide();break;case"escape":this.emit("cancel"),this.CM.unregisterPopup(this),this.hide();break;case"q":this.CM.emit("exit"),this.CM.unregisterPopup(this),this.hide();break;default:break}this.CM.refresh()}}};var Gt=require("events");var bt=_(require("fs"),1),F=_(require("path"),1);var Q=class extends Gt.EventEmitter{constructor(t){if(!t)throw new Error("The config is required");let{id:e,title:i,basePath:s,selectDirectory:n=!1,allowedExtensions:l=[],limitToPath:h=!1,visible:u=!1}=t;if(!e)throw new Error("The id is required");if(!i)throw new Error("The title is required");if(!s)throw new Error("The basePath is required");super();this.parsingMouseFrame=!1;this.dragging=!1;this.dragStart={x:0,y:0};this.focused=!1;this.mouseListener=t=>{let e=t.data.x,i=t.data.y;if(e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+this.absoluteValues.height){if(t.name==="MOUSE_WHEEL_DOWN"){let s=this.options.indexOf(this.selected);this.setSelected(this.options[(s+1)%this.options.length]),this.CM.Screen.height-this.marginTop-4<this.options.length?this.selected===this.options[this.adaptOptions().length+this.startIndex]&&this.startIndex++:this.startIndex=0,this.focused=!0}else if(t.name==="MOUSE_WHEEL_UP"){let s=this.options.indexOf(this.selected);this.setSelected(this.options[(s-1+this.options.length)%this.options.length]),this.startIndex>0&&this.selected===this.adaptOptions()[0]&&this.startIndex--,this.focused=!0}else if(t.name==="MOUSE_LEFT_BUTTON_PRESSED"){let s=i-this.absoluteValues.y-4;s>=0&&s<this.adaptOptions().length&&this.setSelected(this.options[this.startIndex+s]),this.focused=!0}}else this.focused=!1;if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!1&&this.focused)e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+3&&(this.dragging=!0,this.dragStart={x:e,y:i});else if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!0){if(i-this.dragStart.y+this.absoluteValues.y<0||e-this.dragStart.x+this.absoluteValues.x<0)return;this.offsetX+=e-this.dragStart.x,this.offsetY+=i-this.dragStart.y,this.dragStart={x:e,y:i},this.CM.refresh()}else t.name==="MOUSE_LEFT_BUTTON_RELEASED"&&this.dragging===!0&&(this.dragging=!1,this.CM.refresh())};if(this.CM=new y,this.id=e,this.title=i,this.basePath=s,this.currentPath=s,this.selectDirectory=n,this.allowedExtensions=l,this.limitToPath=h,this.visible=u,this.marginTop=4,this.startIndex=0,this.selected={text:"../",name:"../",type:"dir",path:F.default.join(s,"../")},this.offsetX=0,this.offsetY=0,this.absoluteValues={x:0,y:0,width:0,height:0},this.CM.popupCollection[this.id]){this.CM.unregisterPopup(this);let d=`FileSelectorPopup ${this.id} already exists.`;throw this.CM.error(d),new Error(d)}this.CM.registerPopup(this),this.options=[{text:"../",name:"../",type:"dir",path:F.default.join(s,"../")}],this.updateList(this.basePath)}listDir(t){return new Promise((e,i)=>{bt.default.readdir(t,(s,n)=>{s?i(s):e(n.map(l=>{let h=F.default.join(t,l);return bt.default.statSync(h).isDirectory()?{text:`\u{1F4C1} ${l}/`,name:l,type:"dir",path:h}:{text:`\u{1F4C4} ${l}`,name:l,type:"file",path:h}}).filter(l=>{let h=this.allowedExtensions.length===0||this.allowedExtensions.includes(F.default.extname(l.name));return this.selectDirectory&&l.type==="file"?!1:h||l.type==="dir"}))})})}updateList(t){this.limitToPath&&!F.default.resolve(t).includes(F.default.resolve(this.basePath))||(this.currentPath=t,this.listDir(this.currentPath).then(e=>{this.options=[{text:"../",name:"../",type:"dir",path:F.default.join(this.currentPath,"../")}].concat(e),this.setSelected(this.options[0]),this.CM.refresh()}))}adaptOptions(){return this.options.slice(this.startIndex,this.startIndex+this.CM.Screen.height-this.marginTop-6)}keyListener(t,e){let i=this.CM.mouse.isMouseFrame(e,this.parsingMouseFrame);if(i===1){this.parsingMouseFrame=!0;return}else if(i===-1){this.parsingMouseFrame=!1;return}let s=this.options.indexOf(this.selected);switch(e.name){case"down":this.setSelected(this.options[(s+1)%this.options.length]),this.CM.Screen.height-this.marginTop-4<this.options.length?this.selected===this.options[this.adaptOptions().length+this.startIndex]&&this.startIndex++:this.startIndex=0;break;case"up":this.setSelected(this.options[(s-1+this.options.length)%this.options.length]),this.startIndex>0&&this.selected===this.adaptOptions()[0]&&this.startIndex--;break;case"pagedown":if(this.CM.Screen.height-this.marginTop-4<this.options.length)this.setSelected(this.options[(s+this.adaptOptions().length)%this.options.length]),this.startIndex+this.adaptOptions().length<this.options.length?this.startIndex+=this.adaptOptions().length:this.startIndex=0;else return;break;case"pageup":if(this.CM.Screen.height-this.marginTop-4<this.options.length)this.setSelected(this.options[(s-this.adaptOptions().length+this.options.length)%this.options.length]),this.startIndex>this.adaptOptions().length?this.startIndex-=this.adaptOptions().length:this.startIndex=0;else return;break;case"return":this.selectDirectory?this.selected.type==="dir"&&(this.emit("confirm",{path:this.selected.path,name:this.selected.name}),this.CM.unregisterPopup(this),this.hide()):this.selected.type==="dir"?this.updateList(this.selected.path):(this.emit("confirm",{path:this.selected.path,name:this.selected.name}),this.CM.unregisterPopup(this),this.hide());break;case"space":this.selected.type==="dir"&&this.updateList(this.selected.path);break;case"escape":this.emit("cancel"),this.CM.unregisterPopup(this),this.hide();break;case"q":this.CM.emit("exit"),this.CM.unregisterPopup(this),this.hide();break;default:break}this.CM.refresh()}getSelected(){return this.selected}setSelected(t){return this.selected=t,this.CM.refresh(),this}show(){return this.visible||(this.manageInput(),this.visible=!0,this.CM.refresh(),this.CM.unfocusOtherWidgets(this.id)),this}hide(){return this.visible&&(this.unManageInput(),this.visible=!1,this.CM.restoreFocusInWidgets(),this.CM.refresh()),this}isVisible(){return this.visible}getPosition(){return this.absoluteValues}manageInput(){return this.CM.setKeyListener(this.id,this.keyListener.bind(this)),this.CM.mouse&&this.CM.setMouseListener(`${this.id}_mouse`,this.mouseListener.bind(this)),this}unManageInput(){return this.CM.removeKeyListener(this.id),this.CM.mouse&&this.CM.removeMouseListener(`${this.id}_mouse`),this}draw(){let t=this.adaptOptions().indexOf(this.selected),e=this.options.indexOf(this.selected);t===-1&&(this.startIndex=e-this.adaptOptions().length+1>0?e-this.adaptOptions().length+1:0);let i=2,s=this.options.map(M=>M.text).reduce((M,B)=>Math.max(M,B.length),0),n=s>this.title.length?s+2*i:this.title.length+2*i,l=Math.round((n-this.title.length)/2),h=r.normal.topLeft;for(let M=0;M<n;M++)h+=r.normal.horizontal;h+=`${r.normal.topRight}${f.EOL}`,h+=`${r.normal.vertical}${" ".repeat(l)}${this.title}${" ".repeat(n-l-this.title.length)}${r.normal.vertical}${f.EOL}`,h+=`${r.normal.left}${r.normal.horizontal.repeat(n)}${r.normal.right}${f.EOL}`;let u=r.normal.bottomLeft;for(let M=0;M<n;M++)u+=r.normal.horizontal;u+=`${r.normal.bottomRight}${f.EOL}`;let d="";this.adaptOptions().forEach(M=>{d+=`${r.normal.vertical}${M.name===this.selected.name?"<":" "} ${M.text}${M.name===this.selected.name?" >":"  "}${" ".repeat(n-M.text.toString().length-4)}${r.normal.vertical}${f.EOL}`});let p=`${h}${d}${u}`.split(f.EOL),C=Math.round(this.CM.Screen.width/2-n/2);return p.forEach((M,B)=>{this.CM.Screen.cursorTo(C+this.offsetX,this.marginTop+B+this.offsetY),this.CM.Screen.write({text:M,style:{color:"white"}})}),this.absoluteValues={x:C+this.offsetX,y:this.marginTop+this.offsetY,width:n,height:p.length},this}};var Kt=require("events");var Z=class extends Kt.EventEmitter{constructor(t){if(!t)throw new Error("InputPopup config is required");let{id:e,title:i,value:s,numeric:n,visible:l=!1}=t;if(!e)throw new Error("InputPopup id is required");if(!i)throw new Error("InputPopup title is required");if(s===void 0)throw new Error("InputPopup value is required");super();this.flashLoop=setInterval(()=>{this.draw(),this.CM.refresh()},500);this.parsingMouseFrame=!1;this.dragging=!1;this.dragStart={x:0,y:0};this.focused=!1;this.mouseListener=t=>{let e=t.data.x,i=t.data.y;if(e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+this.absoluteValues.height?t.name==="MOUSE_WHEEL_DOWN"?(this.numeric&&(this.value=Number(this.value)-1,this.CM.refresh()),this.focused=!0):t.name==="MOUSE_WHEEL_UP"?(this.numeric&&(this.value=Number(this.value)+1,this.CM.refresh()),this.focused=!0):t.name==="MOUSE_LEFT_BUTTON_PRESSED"&&(this.focused=!0):this.focused=!1,t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!1&&this.focused)e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+3&&(this.dragging=!0,this.dragStart={x:e,y:i});else if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!0){if(i-this.dragStart.y+this.absoluteValues.y<0||e-this.dragStart.x+this.absoluteValues.x<0)return;this.offsetX+=e-this.dragStart.x,this.offsetY+=i-this.dragStart.y,this.dragStart={x:e,y:i},this.CM.refresh()}else t.name==="MOUSE_LEFT_BUTTON_RELEASED"&&this.dragging===!0&&(this.dragging=!1,this.CM.refresh())};if(this.CM=new y,this.id=e,this.title=i,this.value=s,this.cursorPos=0,this.numeric=n||!1,this.visible=l,this.marginTop=4,this.offsetX=0,this.offsetY=0,this.absoluteValues={x:0,y:0,width:0,height:0},this.placeholder=t.placeholder,this.CM.popupCollection[this.id]){this.CM.unregisterPopup(this);let h=`InputPopup ${this.id} already exists.`;throw this.CM.error(h),new Error(h)}this.CM.registerPopup(this)}keyListenerNumeric(t,e){let i=this.CM.mouse.isMouseFrame(e,this.parsingMouseFrame);if(i===1){this.parsingMouseFrame=!0;return}else if(i===-1){this.parsingMouseFrame=!1;return}let s=Number(this.value);if(Number.isNaN(s)&&(s=0),Number.isNaN(Number(e.name)))if(e.sequence==="-")this.value=s*-1;else if(e.sequence==="+")this.value=Math.abs(s);else if(e.sequence==="."||e.sequence===",")this.value.toString().indexOf(".")===-1&&(this.value=s+".");else switch(e.name){case"backspace":this.value.toString().length>0&&(this.value.toString().indexOf(".")===this.value.toString().length-1?this.value=s.toString():this.value.toString().indexOf(".")===this.value.toString().length-2?this.value=this.value.toString().slice(0,this.value.toString().length-1):this.value.toString().indexOf("-")===0&&this.value.toString().length===2?this.value=0:this.value=Number(s.toString().slice(0,s.toString().length-1)));break;case"return":this.confirmDel();break;case"escape":this.delete();break;case"q":this.delete();break;default:break}else if(s.toString().length<20){let n=this.value.toString();n+=e.name,this.value=Number(n)}this.CM.refresh()}keyListenerText(t,e){let i=this.CM.mouse.isMouseFrame(e,this.parsingMouseFrame);if(i===1){this.parsingMouseFrame=!0;return}else if(i===-1){this.parsingMouseFrame=!1;return}let s=this.value;switch(e.name){case"backspace":s.toString().length>0&&(this.value=s.toString().slice(0,s.toString().length-1));break;case"return":this.confirmDel();break;case"escape":this.delete();break;case"q":this.delete();break;case"delete":break;case"tab":this.value=s.toString()+"  ";break;default:if(g(s.toString())<20&&e.sequence.length===1){let n=s.toString();n+=e.sequence,this.value=n}break}this.CM.refresh()}getValue(){return this.value}setValue(t){return this.value=t,this.CM.refresh(),this}show(){return this.visible||(this.manageInput(),this.visible=!0,this.CM.refresh(),this.CM.unfocusOtherWidgets(this.id)),this}hide(){return this.visible&&(this.unManageInput(),this.visible=!1,this.CM.restoreFocusInWidgets(),this.CM.refresh()),this}isVisible(){return this.visible}getPosition(){return this.absoluteValues}manageInput(){return this.numeric?this.CM.setKeyListener(this.id,this.keyListenerNumeric.bind(this)):this.CM.setKeyListener(this.id,this.keyListenerText.bind(this)),this.CM.mouse&&this.CM.setMouseListener(`${this.id}_mouse`,this.mouseListener.bind(this)),this}unManageInput(){return this.numeric?this.CM.removeKeyListener(this.id):this.CM.removeKeyListener(this.id),this.CM.mouse&&this.CM.removeMouseListener(`${this.id}_mouse`),this}draw(){let e=this.title.length>this.value.toString().length?this.title.length+4:this.value.toString().length+4+1,i=Math.round((e-this.title.length)/2),s=r.normal.topLeft;for(let c=0;c<e;c++)s+=r.normal.horizontal;s+=`${r.normal.topRight}${f.EOL}`,s+=`${r.normal.vertical}${" ".repeat(i)}${this.title}${" ".repeat(e-i-this.title.length)}${r.normal.vertical}${f.EOL}`,s+=`${r.normal.left}${r.normal.horizontal.repeat(e)}${r.normal.right}${f.EOL}`;let n=r.normal.bottomLeft;for(let c=0;c<e;c++)n+=r.normal.horizontal;n+=`${r.normal.bottomRight}${f.EOL}`;let l="";l+=`${r.normal.vertical}> ${this.value}\u2588${" ".repeat(e-this.value.toString().length-3)}${r.normal.vertical}${f.EOL}`;let h=`${s}${l}${n}`,u=h.split(f.EOL),d=Math.round(this.CM.Screen.width/2-e/2);return h.split(f.EOL).forEach((c,p)=>{if(this.CM.Screen.cursorTo(d+this.offsetX,this.marginTop+p+this.offsetY),p===3&&this.placeholder?.length&&this.value.toString().length===0){let C=Math.round(Date.now()/100)%2;return this.CM.Screen.write({text:`${r.normal.vertical}> ${C?"\u2588":" "}${E.gray(this.placeholder)}${" ".repeat(e-this.placeholder.length-3)}${r.normal.vertical}${f.EOL}`,style:{color:"white"}})}else if(p===3){let C=Math.round(Date.now()/100)%2;return this.CM.Screen.write({text:`${r.normal.vertical}> ${this.value}${C?"\u2588":" "}${" ".repeat(e-this.value.toString().length-3)}${r.normal.vertical}${f.EOL}`,style:{color:"white"}})}this.CM.Screen.write({text:c,style:{color:"white"}})}),this.absoluteValues={x:d+this.offsetX,y:this.marginTop+this.offsetY,width:e,height:u.length},this}confirmDel(){this.emit("confirm",Number(this.value)),this.delete()}delete(){this.CM.unregisterPopup(this),this.hide(),clearInterval(this.flashLoop)}};var jt=require("events");var tt=class extends jt.EventEmitter{constructor(t){if(!t)throw new Error("OptionPopup config is required");let{id:e,title:i,options:s,selected:n,visible:l=!1}=t;if(!e)throw new Error("OptionPopup id is required");if(!i)throw new Error("OptionPopup title is required");if(!s)throw new Error("OptionPopup options is required");if(n==null)throw new Error("OptionPopup selected is required");super();this.parsingMouseFrame=!1;this.dragging=!1;this.dragStart={x:0,y:0};this.focused=!1;this.mouseListener=t=>{let e=t.data.x,i=t.data.y;if(e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+this.absoluteValues.height){if(t.name==="MOUSE_WHEEL_DOWN")this.setSelected(this.options[(this.options.indexOf(this.selected)+1)%this.options.length]),this.CM.Screen.height-this.marginTop-4<this.options.length?this.selected===this.options[this.adaptOptions().length+this.startIndex]&&this.startIndex++:this.startIndex=0,this.focused=!0;else if(t.name==="MOUSE_WHEEL_UP")this.setSelected(this.options[(this.options.indexOf(this.selected)-1+this.options.length)%this.options.length]),this.startIndex>0&&this.selected===this.adaptOptions()[0]&&this.startIndex--,this.focused=!0;else if(t.name==="MOUSE_LEFT_BUTTON_PRESSED"){let s=i-this.absoluteValues.y-4;s>=0&&s<this.adaptOptions().length&&this.setSelected(this.options[this.startIndex+s]),this.focused=!0}}else this.focused=!1;if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!1&&this.focused)e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<this.absoluteValues.y+3&&(this.dragging=!0,this.dragStart={x:e,y:i});else if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!0){if(i-this.dragStart.y+this.absoluteValues.y<0||e-this.dragStart.x+this.absoluteValues.x<0)return;this.offsetX+=e-this.dragStart.x,this.offsetY+=i-this.dragStart.y,this.dragStart={x:e,y:i},this.CM.refresh()}else t.name==="MOUSE_LEFT_BUTTON_RELEASED"&&this.dragging===!0&&(this.dragging=!1,this.CM.refresh())};if(this.CM=new y,this.id=e,this.title=i,this.options=s,this.selected=n,this.visible=l,this.marginTop=4,this.startIndex=0,this.offsetX=0,this.offsetY=0,this.absoluteValues={x:0,y:0,width:0,height:0},this.CM.popupCollection[this.id]){this.CM.unregisterPopup(this);let h=`OptionPopup ${this.id} already exists.`;throw this.CM.error(h),new Error(h)}this.CM.registerPopup(this)}adaptOptions(){return this.options.slice(this.startIndex,this.startIndex+this.CM.Screen.height-this.marginTop-6)}keyListener(t,e){let i=this.CM.mouse.isMouseFrame(e,this.parsingMouseFrame);if(i===1){this.parsingMouseFrame=!0;return}else if(i===-1){this.parsingMouseFrame=!1;return}switch(e.name){case"down":this.setSelected(this.options[(this.options.indexOf(this.selected)+1)%this.options.length]),this.CM.Screen.height-this.marginTop-4<this.options.length?this.selected===this.options[this.adaptOptions().length+this.startIndex]&&this.startIndex++:this.startIndex=0;break;case"up":this.setSelected(this.options[(this.options.indexOf(this.selected)-1+this.options.length)%this.options.length]),this.startIndex>0&&this.selected===this.adaptOptions()[0]&&this.startIndex--;break;case"pagedown":if(this.CM.Screen.height-this.marginTop-4<this.options.length)this.setSelected(this.options[(this.options.indexOf(this.selected)+this.adaptOptions().length)%this.options.length]),this.startIndex+this.adaptOptions().length<this.options.length?this.startIndex+=this.adaptOptions().length:this.startIndex=0;else return;break;case"pageup":if(this.CM.Screen.height-this.marginTop-4<this.options.length)this.setSelected(this.options[(this.options.indexOf(this.selected)-this.adaptOptions().length+this.options.length)%this.options.length]),this.startIndex>this.adaptOptions().length?this.startIndex-=this.adaptOptions().length:this.startIndex=0;else return;break;case"return":this.emit("confirm",this.selected),this.CM.unregisterPopup(this),this.hide();break;case"escape":this.emit("cancel"),this.CM.unregisterPopup(this),this.hide();break;case"q":this.CM.emit("exit"),this.CM.unregisterPopup(this),this.hide();break;default:break}this.CM.refresh()}getSelected(){return this.selected}setSelected(t){return this.selected=t,this.CM.refresh(),this}show(){return this.visible||(this.manageInput(),this.visible=!0,this.CM.refresh(),this.CM.unfocusOtherWidgets(this.id)),this}hide(){return this.visible&&(this.unManageInput(),this.visible=!1,this.CM.restoreFocusInWidgets(),this.CM.refresh()),this}isVisible(){return this.visible}getPosition(){return this.absoluteValues}manageInput(){return this.CM.setKeyListener(this.id,this.keyListener.bind(this)),this.CM.mouse&&this.CM.setMouseListener(`${this.id}_mouse`,this.mouseListener.bind(this)),this}unManageInput(){return this.CM.removeKeyListener(this.id),this.CM.mouse&&this.CM.removeMouseListener(`${this.id}_mouse`),this}draw(){this.adaptOptions().indexOf(this.selected)===-1&&(this.startIndex=this.options.indexOf(this.selected)-this.adaptOptions().length+1>0?this.options.indexOf(this.selected)-this.adaptOptions().length+1:0);let t=2,e=this.options.map(p=>p.toString()).reduce((p,C)=>Math.max(p,C.length),0),i=e>this.title.length?e+2*t:this.title.length+2*t,s=Math.round((i-this.title.length)/2),n=r.normal.topLeft;for(let p=0;p<i;p++)n+=r.normal.horizontal;n+=`${r.normal.topRight}${f.EOL}`,n+=`${r.normal.vertical}${" ".repeat(s)}${this.title}${" ".repeat(i-s-this.title.length)}${r.normal.vertical}${f.EOL}`,n+=`${r.normal.left}${r.normal.horizontal.repeat(i)}${r.normal.right}${f.EOL}`;let l=r.normal.bottomLeft;for(let p=0;p<i;p++)l+=r.normal.horizontal;l+=`${r.normal.bottomRight}${f.EOL}`;let h="";this.adaptOptions().forEach(p=>{h+=`${r.normal.vertical}${p===this.selected?"<":" "} ${p}${p===this.selected?" >":"  "}${" ".repeat(i-p.toString().length-4)}${r.normal.vertical}${f.EOL}`});let d=`${n}${h}${l}`.split(f.EOL),c=Math.round(this.CM.Screen.width/2-i/2);return d.forEach((p,C)=>{this.CM.Screen.cursorTo(c+this.offsetX,this.marginTop+C+this.offsetY),this.CM.Screen.write({text:p,style:{color:"white"}})}),this.absoluteValues={x:c+this.offsetX,y:this.marginTop+this.offsetY,width:i,height:d.length},this}};var Xt=require("events");var K=class extends Xt.EventEmitter{constructor(t){if(!t)throw new Error("The configuration object is required.");if(!t.id)throw new Error("The id is required.");if(!t.attributes)throw new Error("The attributes are required.");if(!t.children)throw new Error("The children are required.");super();this.parsingMouseFrame=!1;this.absoluteValues={x:0,y:0,width:0,height:0};this.draggable=!0;this.dragging=!1;this.dragStart={x:0,y:0};this.focused=!1;this.hovered=!1;this.mouseListener=t=>{let e=t.data.x,i=t.data.y;if(e>this.absoluteValues.x&&e<this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<=this.absoluteValues.y+this.absoluteValues.height){let s=Object.keys(this.CM.popupCollection);for(let l=s.length-1;l>=0;l--){let h=this.CM.popupCollection[s[l]];if(h.isVisible()&&h.getPosition){let u=h.getPosition();if(e>u.x&&e<u.x+u.width&&i>u.y&&i<u.y+u.height)return}}this.emit("mouse",t);let n={name:t.name,data:{x:e-this.absoluteValues.x,y:i-this.absoluteValues.y}};if(this.emit("relativeMouse",n),t.name==="MOUSE_LEFT_BUTTON_PRESSED"){this.focused||(this.focused=!0);return}t.name==="MOUSE_MOTION"&&(this.focused=!0,this.hovered||(this.hovered=!0))}else t.name!=="MOUSE_MOTION"&&(this.focused=!1),this.hovered&&(this.hovered=!1,this.emit("hoverOut",t));if(this.draggable)if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!1&&this.focused)e>this.absoluteValues.x&&e<=this.absoluteValues.x+this.absoluteValues.width&&i>this.absoluteValues.y&&i<=this.absoluteValues.y+this.absoluteValues.height&&(this.dragging=!0,this.dragStart={x:e,y:i});else if(t.name==="MOUSE_DRAG"&&t.data.left===!0&&this.dragging===!0){if(i-this.dragStart.y+this.absoluteValues.y<0||e-this.dragStart.x+this.absoluteValues.x<0)return;this.absoluteValues.x+=e-this.dragStart.x,this.absoluteValues.y+=i-this.dragStart.y,this.dragStart={x:e,y:i},this.CM.refresh()}else t.name==="MOUSE_LEFT_BUTTON_RELEASED"&&this.dragging===!0&&(this.dragging=!1,this.CM.refresh())};if(this.CM=new y,this.id=t.id,this.visible=t.visible||!0,this.absoluteValues=t.attributes,this.children=t.children,this.CM.controlsCollection[this.id]){this.CM.unregisterControl(this);let e=`Control ${this.id} already exists.`;throw this.CM.error(e),new Error(e)}this.CM.registerControl(this),this.visible&&(this.manageInput(),this.CM.refresh())}delete(){this.unfocus(),this.hide(),this.CM.unregisterControl(this)}keyListener(t,e){let i=this.CM.mouse.isMouseFrame(e,this.parsingMouseFrame);if(i===1){this.parsingMouseFrame=!0;return}else if(i===-1){this.parsingMouseFrame=!1;return}switch(e.name){case"return":break;case"escape":this.unfocus();break;default:break}this.emit("keypress",e),this.CM.refresh()}getContent(){return this.children}focus(){return this.visible&&!this.focused&&(this.focused=!0,this.manageInput()),this}unfocus(){return this.visible&&this.focused&&(this.unManageInput(),this.focused=!1),this}show(){return this.visible||(this.manageInput(),this.visible=!0,this.CM.refresh()),this}hide(){return this.visible&&(this.unManageInput(),this.visible=!1,this.CM.refresh()),this}isVisible(){return this.visible}isFocused(){return this.focused}manageInput(){return this.CM.setKeyListener(this.id,this.keyListener.bind(this)),this.CM.mouse&&this.CM.setMouseListener(`${this.id}_mouse`,this.mouseListener.bind(this)),this}unManageInput(){return this.CM.removeKeyListener(this.id),this.CM.mouse&&this.CM.removeMouseListener(`${this.id}_mouse`),this}drawLine(t){let e="",i=[...t];if(t.forEach(s=>{e+=s.text}),g(e)>this.absoluteValues.width){i=[...JSON.parse(JSON.stringify(t))];let n=g(e)-this.CM.Screen.width+1;for(let l=i.length-1;l>=0;l--)if(g(i[l].text)>n+2){i[l].text=x(i[l].text,g(i[l].text)-n-2,!0);break}else n-=g(i[l].text),i.splice(l,1);e=i.map(l=>l.text).join("")}g(e)<=this.absoluteValues.width&&i.push({text:`${" ".repeat(this.absoluteValues.width-g(e))}`,style:{color:""}}),this.CM.Screen.write(...i)}draw(){return this.children.getContent().forEach((t,e)=>{this.CM.Screen.cursorTo(this.absoluteValues.x,e+this.absoluteValues.y),this.drawLine(t)}),this}},W=K;var et=class extends W{constructor(t){if(!t.id)throw new Error("The id is required");if(t.x===void 0||t.y===void 0)throw new Error("The x and y values are required");let e={width:t.width||10,height:t.height||5},i={x:t.x,y:t.y,width:e.width,height:e.height};super({id:t.id,visible:t.visible||!0,attributes:i,children:new I(i.height)});this.style={boxed:!1,label:"",color:"white"};this.update=()=>{if(this.style.boxed){let t=this.absoluteValues,e=this.style.label?x(this.style.label,t.width-2,!1):"";this.getContent().clear(),this.getContent().addRow({text:`${r.normal.topLeft}${e}${r.normal.horizontal.repeat(t.width-(2+g(e)))}${r.normal.topRight}`,color:this.style.color});for(let i=0;i<t.height-2;i++)if(this.content.getViewedPageHeight()>i){let s=this.content.getContent()[i].reduce((h,u)=>h+g(u.text),0),n=t.width-(s+2),l=[{text:`${r.normal.vertical}`,style:{color:this.style.color}},...this.content.getContent()[i],{text:`${" ".repeat(n>0?n:0)}${r.normal.vertical}`,style:{color:this.style.color}}];this.drawInnerLine(l)}this.getContent().addRow({text:`${r.normal.bottomLeft}${r.normal.horizontal.repeat(t.width-2)}${r.normal.bottomRight}`,color:this.style.color})}else{this.getContent().clear();for(let t=0;t<this.absoluteValues.height;t++)this.content.getViewedPageHeight()>t&&this.drawInnerLine(this.content.getContent()[t])}return this.CM.refresh(),this};this.setLabel=t=>(this.style.label=t,this.update(),this);this.setStyle=t=>(this.style=t,this.update(),this);this.setContent=t=>(this.content=t,this.content.setRowsPerPage(this.style.boxed?this.absoluteValues.height-2:this.absoluteValues.height),this.update(),this);this.style.label=t.style?.label||"",this.style=t.style?{...this.style,...t.style}:this.style,this.content=new I(this.style.boxed?this.absoluteValues.height-2:this.absoluteValues.height),this.draggable=t.draggable||!1,this.on("keypress",s=>{this.focused&&(s.name==="up"?(this.content.increaseScrollIndex(),this.update()):s.name==="down"&&(this.content.decreaseScrollIndex(),this.update()))}),this.on("relativeMouse",s=>{this.focused&&(s.name==="MOUSE_WHEEL_UP"?(this.content.increaseScrollIndex(),this.update()):s.name==="MOUSE_WHEEL_DOWN"&&(this.content.decreaseScrollIndex(),this.update()))}),this.update()}drawInnerLine(t){let e="",i=[...t];if(t.forEach(s=>{e+=s.text}),g(e)>this.absoluteValues.width){i=[...JSON.parse(JSON.stringify(t))];let n=g(e)-this.absoluteValues.width+1;for(let l=i.length-1;l>=0;l--)if(g(i[l].text)>n+2){i[l].text=x(i[l].text,g(i[l].text)-n-2,!1);break}else n-=g(i[l].text),i.splice(l,1);e=i.map(l=>l.text).join(""),this.style.boxed&&i.push({text:`${" ".repeat(this.absoluteValues.width-g(e)-1)}${r.normal.vertical}`,style:{color:this.style.color}})}g(e)<=this.absoluteValues.width&&i.push({text:`${" ".repeat(this.absoluteValues.width-g(e))}`,style:{color:""}}),this.getContent().addRow(...i.map(s=>Et(s)))}};var it=class extends W{constructor(t){let e={width:0,height:0};if(t.width?e.width=t.width:e.width=t.text.length+4,t.height?e.height=t.height:e.height=3,!t.id)throw new Error("The id is required");if(t.x===void 0||t.y===void 0)throw new Error("The x and y values are required");let i={x:t.x,y:t.y,width:e.width,height:e.height};super({id:t.id,visible:t.visible||!0,attributes:i,children:new I});this.text="TEXT";this.enabled=!0;this.style={background:"bgBlack",borderColor:"white",color:"white",bold:!0};this.status="normal";this.update=()=>{let t=this.absoluteValues,e=x(this.text,t.width-2,!1);return(e.length+(t.width-2))%2===1&&(e+=" "),this.getContent().clear(),this.getContent().addRow({text:`${r[this.status].topLeft}${r[this.status].horizontal.repeat(t.width-2)}${r[this.status].topRight}`,bg:this.style.background,color:this.style.borderColor,bold:this.style.bold}),this.getContent().addRow({text:`${r[this.status].vertical}`,bg:this.style.background,color:this.style.borderColor,bold:this.style.bold},{text:`${" ".repeat((t.width-2-e.length)/2)}${e}${" ".repeat((t.width-2-e.length)/2)}`,bg:this.style.background,color:this.style.color,bold:this.style.bold,italic:this.style.italic,dim:this.style.dim,underline:this.style.underline,inverse:this.style.inverse,hidden:this.style.hidden,strikethrough:this.style.strikethrough,overline:this.style.overline},{text:`${r[this.status].vertical}`,bg:this.style.background,color:this.style.borderColor,bold:this.style.bold}),this.getContent().addRow({text:`${r[this.status].bottomLeft}${r[this.status].horizontal.repeat(t.width-2)}${r[this.status].bottomRight}`,bg:this.style.background,color:this.style.borderColor,bold:this.style.bold}),this.CM.refresh(),this};this.setText=t=>(this.text=t,this.update(),this);this.setStyle=t=>(this.style=t,this.update(),this);this.setEnabled=t=>(this.enabled=t,this.update(),this);this.text=t.text||"TEXT",this.enabled=t.enabled||!0,this.onClick=t.onClick||(()=>{}),this.onRelease=t.onRelease||(()=>{}),this.style=t.style?{...this.style,...t.style}:this.style,this.draggable=t.draggable||!1,this.key=t.key?{name:t.key.name,ctrl:t.key.ctrl||!1,shift:t.key.shift||!1,meta:t.key.meta||!1}:void 0,this.on("keypress",s=>{if(this.key){if(s.name===this.key.name&&s.ctrl===this.key.ctrl&&s.shift===this.key.shift&&s.meta===this.key.meta){this.status="selected",this.update(),this.onClick&&this.onClick.call(this),this.emit("click");return}this.status="normal",this.update()}}),this.on("relativeMouse",s=>{this.enabled&&(s.name==="MOUSE_LEFT_BUTTON_PRESSED"&&(this.status="selected",this.update(),this.onClick&&this.onClick.call(this),this.emit("click")),s.name==="MOUSE_LEFT_BUTTON_RELEASED"&&(this.status="hovered",this.update(),this.onRelease&&this.onRelease.call(this),this.emit("release")),s.name==="MOUSE_RIGHT_BUTTON_PRESSED"&&this.emit("rightClick"),s.name==="MOUSE_RIGHT_BUTTON_RELEASED"&&this.emit("rightRelease"),s.name==="MOUSE_MOTION"&&this.status==="normal"&&(this.status="hovered",this.update()))}),this.on("hoverOut",()=>{this.status="normal",this.update()}),this.update()}};var S={precision:{horizontal:{100:{char:"\u2588",color:void 0},88:{char:"\u2589",color:void 0},75:{char:"\u258A",color:void 0},63:{char:"\u258B",color:void 0},50:{char:"\u258C",color:void 0},38:{char:"\u258D",color:void 0},25:{char:"\u258E",color:void 0},13:{char:"\u258F",color:void 0},0:{char:" ",color:void 0}},vertical:{100:{char:"\u2588",color:void 0},88:{char:"\u2587",color:void 0},75:{char:"\u2586",color:void 0},63:{char:"\u2585",color:void 0},50:{char:"\u2584",color:void 0},38:{char:"\u2583",color:void 0},25:{char:"\u2582",color:void 0},13:{char:"\u2581",color:void 0},0:{char:" ",color:void 0}},block:{full:{char:"\u2593",color:void 0},half:{char:"\u2592",color:void 0},empty:{char:"\u2591",color:void 0},boxDrawing:r.normal,labelStyle:void 0,valueStyle:void 0}},"htop-light":{horizontal:{100:{char:"\u2502",color:"#15a121"},75:{char:"\u2502",color:"#c09c22"},50:{char:"\u2502",color:"#0c37d6"},25:{char:"\u2502",color:"#c40c26"},0:{char:" ",color:void 0}},vertical:{100:{char:"\u2500",color:"#15a121"},75:{char:"\u2500",color:"#c09c22"},50:{char:"\u2500",color:"#0c37d6"},25:{char:"\u2500",color:"#c40c26"},0:{char:" ",color:void 0}},block:{full:{char:"\u2588",color:void 0},half:{char:"\u2593",color:void 0},empty:{char:"\u2591",color:void 0},boxDrawing:{left:"[",right:"]"},labelStyle:{color:"#3d96da",bold:!1},valueStyle:{color:"gray",dim:!0}}},"htop-heavy":{horizontal:{100:{char:"\u2503",color:"#15a121"},75:{char:"\u2503",color:"#c09c22"},50:{char:"\u2503",color:"#0c37d6"},25:{char:"\u2503",color:"#c40c26"},0:{char:" ",color:void 0}},vertical:{100:{char:"\u2501",color:"#15a121"},75:{char:"\u2501",color:"#c09c22"},50:{char:"\u2501",color:"#0c37d6"},25:{char:"\u2501",color:"#c40c26"},0:{char:" ",color:void 0}},block:{full:{char:"\u2588",color:void 0},half:{char:"\u2593",color:void 0},empty:{char:"\u2591",color:void 0},boxDrawing:{color:"white",left:"[",right:"]"},labelStyle:{color:"#3d96da",bold:!0},valueStyle:{color:"gray",dim:!0}}},htop:{horizontal:{100:{char:"|",color:"#15a121"},75:{char:"|",color:"#c09c22"},50:{char:"|",color:"#0c37d6"},25:{char:"|",color:"#c40c26"},0:{char:" ",color:void 0}},vertical:{100:{char:"\u2015",color:"#15a121"},75:{char:"\u2015",color:"#c09c22"},50:{char:"\u2015",color:"#0c37d6"},25:{char:"\u2015",color:"#c40c26"},0:{char:" ",color:void 0}},block:{full:{char:"\u2588",color:void 0},half:{char:"\u2593",color:void 0},empty:{char:"\u2591",color:void 0},boxDrawing:{start:"[",end:"]"},labelStyle:{color:"#3d96da",bold:!0},valueStyle:{color:"gray",dim:!0}}}},st=class extends W{constructor(t){if(!t.id)throw new Error("The id is required");if(t.x===void 0||t.y===void 0)throw new Error("The x and y values are required");let e=t.orientation||"horizontal",i=t.length||20,s=t.thickness||1,n=e==="horizontal"?i:s,l=e==="horizontal"?s:i;t.style&&t.style.boxed&&(n+=2,l+=2);let h={x:t.x,y:t.y,width:n,height:l};super({id:t.id,visible:t.visible||!0,attributes:h,children:new I});this.thickness=1;this.orientation="horizontal";this.increment=1;this.interactive=!1;this.label="";this.enabled=!0;this.theme="precision";this.style={background:"bgBlack",borderColor:"white",color:"white",textColor:"white",bold:!0,boxed:!0,showPercentage:!0,showValue:!0,showMinMax:!0,showTitle:!0};this.status="normal";this.onValueChanged=()=>{};this.getProgress=()=>{let t=[[]],e=this.value/this.max*100;e>100&&(e=100),e<0&&(e=0);let i=this.length,s=i*8,n=Math.round(e/100*s),l=Math.round(n%8*10),h=Math.floor(n/8),u=i-h-1;if(l===0){u=i-h;for(let d=0;d<h;d++)t[0].push({text:S[this.theme][this.orientation][100].char,color:S[this.theme][this.orientation][100].color||this.style.color})}else{let d=Number(Object.keys(S[this.theme][this.orientation]).find(p=>Number(p)>=l)),c=S[this.theme][this.orientation][Number(d)].char;for(let p=0;p<h;p++)t[0].push({text:S[this.theme][this.orientation][100].char,color:S[this.theme][this.orientation][100].color||this.style.color});t[0].push({text:c,color:S[this.theme][this.orientation][d].color||this.style.color})}for(let d=0;d<u;d++)t[0].push({text:S[this.theme][this.orientation][0].char,color:S[this.theme][this.orientation][0].color||this.style.color});for(let d=1;d<this.thickness;d++)t.push([...t[0]]);return t};this.update=()=>{let t=this.getProgress();if(this.style.boxed)if(Object.keys(S[this.theme].block.boxDrawing).includes("start"))t[0].unshift({text:S[this.theme].block.boxDrawing.start,color:S[this.theme].block.boxDrawing.color,bold:!0}),t[0].push({text:S[this.theme].block.boxDrawing.end,color:S[this.theme].block.boxDrawing.color,bold:!0});else{let n={};if(this.orientation==="vertical"){let l=JSON.parse(JSON.stringify(S[this.theme].block.boxDrawing));n={topLeft:l.bottomLeft,topRight:l.topLeft,bottomLeft:l.bottomRight,bottomRight:l.topRight,horizontal:l.vertical,vertical:l.horizontal,cross:l.cross,left:l.bottom,right:l.top,top:l.left,bottom:l.right}}else n=S[this.theme].block.boxDrawing;t.unshift([{text:n.topLeft,color:this.style.borderColor}]);for(let l=0;l<this.length;l++)t[0].push({text:n.horizontal,color:this.style.borderColor});t[0].push({text:n.topRight,color:this.style.borderColor});for(let l=0;l<this.thickness;l++)t[l+1].unshift({text:n.vertical,color:this.style.borderColor}),t[l+1].push({text:n.vertical,color:this.style.borderColor});t.push([{text:n.bottomLeft,color:this.style.borderColor}]);for(let l=0;l<this.length;l++)t[1+this.thickness].push({text:n.horizontal,color:this.style.borderColor});t[1+this.thickness].push({text:n.bottomRight,color:this.style.borderColor})}let i=t.length===1,s=Math.round(this.value/this.max*100);if(this.getContent().clear(),this.orientation==="horizontal"){if(i)this.style.showTitle&&t[0].unshift({text:this.label,...S[this.theme].block.labelStyle}),this.style.showValue&&(t[0].push({text:`${this.value.toFixed(2)}${this.unit?this.unit:""}`,...S[this.theme].block.valueStyle}),this.style.showPercentage&&t[0].push({text:"/",...S[this.theme].block.valueStyle})),this.style.showPercentage&&t[0].push({text:`${s}%`,...S[this.theme].block.valueStyle}),this.style.showMinMax&&t.push([{text:`(${this.min}/${this.max})`,...S[this.theme].block.valueStyle}]);else{let n=[];this.style.showTitle&&n.push({text:this.label,...S[this.theme].block.labelStyle});let l=" ";this.style.showValue&&(l+=`${this.value.toFixed(2)}${this.unit?this.unit:""}`),this.style.showPercentage&&(l+=` ${s}%`),this.style.showMinMax&&(l+=` (${this.min}/${this.max})`),l.length>0&&n.push({text:l,...S[this.theme].block.valueStyle}),t.push(n)}this.absoluteValues.height=t.length,this.absoluteValues.width=t[0].length,t.forEach(n=>{this.getContent().addRow(...n)})}else{this.absoluteValues.height=t[0].length,this.absoluteValues.width=t.length;for(let h=t[0].length-1;h>=0;h--){let u=[],d=t.length;for(let c=0;c<d;c++)u.push(t[c][h]);this.getContent().addRow(...u)}let n=[];this.style.showTitle&&n.push({text:this.label,...S[this.theme].block.labelStyle});let l=" ";this.style.showValue&&(l+=`${this.value.toFixed(2)}${this.unit?this.unit:""}`),this.style.showPercentage&&(l+=` ${s}%`),this.style.showMinMax&&(l+=` (${this.min}/${this.max})`),l.length>0&&n.push({text:l,...S[this.theme].block.valueStyle}),this.getContent().addRow(...n)}return this.CM.refresh(),this};this.getMax=()=>this.max;this.getMin=()=>this.min;this.getValue=()=>this.value;this.getLength=()=>this.length;this.getThickness=()=>this.thickness;this.getIncrement=()=>this.increment;this.setIncrement=t=>{if(typeof t!="number"||Number.isNaN(t)||t<=0)throw new TypeError('The "increment" value must a nonnegative number.');return this.increment=t,this};this.setLength=t=>(this.length=t,this.orientation==="horizontal"?this.absoluteValues.width=t+(this.style.boxed?2:0):this.absoluteValues.height=t+(this.style.boxed?2:0),this.update(),this);this.setThickness=t=>(this.thickness=t,this.orientation==="horizontal"?this.absoluteValues.width=t+(this.style.boxed?2:0):this.absoluteValues.height=t+(this.style.boxed?2:0),this.update(),this);this.setValue=t=>(t!==this.value&&(this.value=t,this.update()),this);this.setMax=t=>(t!==this.max&&(this.max=t,this.update()),this);this.setMin=t=>(t!==this.min&&(this.min=t,this.update()),this);this.setLabel=t=>(this.label=t,this.update(),this);this.setStyle=t=>(this.style=t,this.update(),this);this.setEnabled=t=>(this.enabled=t,this.update(),this);this.id=t.id,this.theme=t.style?.theme||this.theme,this.enabled=t.enabled||!0,this.onValueChanged=t.onValueChanged||(()=>{}),this.style=t.style?{...this.style,...t.style}:this.style,this.draggable=t.draggable||!1,this.interactive=t.interactive||!1,this.length=i,this.thickness=s,this.orientation=e,this.increment=t.increment||1,this.value=t.value||0,this.max=t.max||100,this.min=t.min||0,this.label=t.label||"",this.unit=t.unit||void 0,this.interactive&&(this.on("relativeMouse",u=>{this.enabled&&(u.name==="MOUSE_LEFT_BUTTON_PRESSED"&&(this.status="selected",this.update(),this.emit("click")),u.name==="MOUSE_LEFT_BUTTON_RELEASED"&&(this.status="hovered",this.update(),this.emit("release")),u.name==="MOUSE_RIGHT_BUTTON_PRESSED"&&this.emit("rightClick"),u.name==="MOUSE_RIGHT_BUTTON_RELEASED"&&this.emit("rightRelease"),u.name==="MOUSE_MOTION"&&this.status==="normal"&&(this.status="hovered"),u.name==="MOUSE_WHEEL_DOWN"&&(this.value>this.min+1?this.value-=this.increment:this.value=this.min,this.emit("valueChanged",this.value),this.onValueChanged&&this.onValueChanged.call(this,this.value),this.update()),u.name==="MOUSE_WHEEL_UP"&&(this.value<this.max-1?this.value+=this.increment:this.value=this.max,this.emit("valueChanged",this.value),this.onValueChanged&&this.onValueChanged.call(this,this.value),this.update()))}),this.on("hoverOut",()=>{this.status="normal"})),this.update()}};var mt=class{constructor(o,t,e,i=0){this.realWidth=0;this.CM=new y,this.options=e,this.selected=i,this.page1=o,this.page2=t,this.boxBold=this.options.boxStyle==="bold",this.proportions=this.options.pageRatio||[.7,.3],this.page2Title=this.options.page2Title||"",this.page1Title=this.options.page1Title||""}setPage(o,t){t==0?this.page1=o:this.page2=o}setPage1(o){this.page1=o}setPage2(o){this.page2=o}setTitles(o){this.page1Title=o[0],this.page2Title=o[1]}setTitle(o,t){t==0?this.page1Title=o:this.page2Title=o}setBorder(o){this.options.boxed=o}setSelected(o){this.selected=o}getSelected(){return this.selected}changeLayout(){this.selected==0?this.selected=1:this.selected=0}setRatio(o){this.proportions=o}increaseRatio(o){this.options.direction=="horizontal"&&this.proportions[0]<.9&&(this.proportions[0]=Number((this.proportions[0]+o).toFixed(2)),this.proportions[1]=Number((this.proportions[1]-o).toFixed(2)))}decreaseRatio(o){this.options.direction=="horizontal"&&this.proportions[0]>.1&&(this.proportions[0]=Number((this.proportions[0]-o).toFixed(2)),this.proportions[1]=Number((this.proportions[1]+o).toFixed(2)))}drawLine(o,t,e=0){let i=!this.options.direction||this.options.direction==="vertical"?"vertical":"horizontal",s=this.options.boxed?i==="vertical"?2:3:0,n=[""],l=[[...o]];if(i==="vertical"?o.forEach(h=>{n[0]+=h.text}):(l=[[...o],[...t||o]],n.push(""),o.forEach(h=>{n[0]+=h.text}),t?.forEach(h=>{n[1]+=h.text})),n.filter((h,u)=>g(h)>(typeof this.realWidth=="number"?this.realWidth:this.realWidth[u])-s).length>0&&(n=n.map((h,u)=>{let d=typeof this.realWidth=="number"?this.realWidth:this.realWidth[u];if(g(h)>d-s){i==="vertical"?l[u]=[...JSON.parse(JSON.stringify(o))]:l[u]=JSON.parse(JSON.stringify(u===0?o:t));let p=g(h)-d+1;for(let C=l[u].length-1;C>=0;C--)if(g(l[u][C].text)>p+2){l[u][C].text=x(l[u][C].text,g(l[u][C].text)-p-2,!1);break}else p-=g(l[u][C].text),l[u].splice(C,1);return l[u].map(C=>C.text).join("")}return h})),i==="vertical")this.options.boxed&&l[0].unshift({text:r.normal.vertical,style:{color:this.selected===e?this.options.boxColor:"white",bold:this.boxBold}}),g(n[0])<=this.CM.Screen.width-s&&l[0].push({text:`${" ".repeat(this.CM.Screen.width-g(n[0])-s)}`,style:{}}),this.options.boxed&&l[0].push({text:r.normal.vertical,style:{color:this.selected===e?this.options.boxColor:"white",bold:this.boxBold}}),this.CM.Screen.write(...l[0]);else{let h=typeof this.realWidth=="number"?[this.realWidth,0]:[this.realWidth[0],this.realWidth[1]],u=[];this.options.boxed&&u.push({text:r.normal.vertical,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}}),u.push(...l[0]),g(n[0])<=h[0]-s&&u.push({text:`${" ".repeat(h[0]-g(n[0])-(s>0?2:0))}`,style:{color:""}}),this.options.boxed&&u.push({text:r.normal.vertical,style:{color:this.options.boxColor,bold:this.boxBold}}),u.push(...l[1]),g(n[1])<=h[1]-s&&u.push({text:`${" ".repeat(h[1]-g(n[1])-(s>0?1:0))}`,style:{color:""}}),this.options.boxed&&u.push({text:r.normal.vertical,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}}),this.CM.Screen.write(...u)}}draw(){if(this.isOdd=this.CM.Screen.width%2===1,!this.options.direction||this.options.direction==="vertical"){this.realWidth=[Math.round(this.CM.Screen.width*1),Math.round(this.CM.Screen.width*1)];let o=[x(this.page1Title,this.realWidth[0]-4,!1),x(this.page2Title,this.realWidth[1]-4,!1)],t=[this.page1.getViewedPageHeight(),this.page2.getViewedPageHeight()];if(this.options.fitHeight){let e=this.options.boxed||this.options.showTitle?2:0,i=(this.CM.Screen.height-e)/2-1;if(Math.max(...t)>i){let s=i/Math.max(...t);t[0]=Math.round(t[0]*s),t[1]=Math.round(t[1]*s)}else t[0]=i,t[1]=i}if(this.options.boxed){this.options.showTitle?this.CM.Screen.write({text:`${r.normal.topLeft}${r.normal.horizontal}${o[0]}${r.normal.horizontal.repeat(this.CM.Screen.width-g(o[0])-3)}${r.normal.topRight}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}}):this.CM.Screen.write({text:`${r.normal.topLeft}${r.normal.horizontal}${r.normal.horizontal.repeat(this.CM.Screen.width-3)}${r.normal.topRight}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}});for(let e=0;e<t[0];e++)this.drawLine(this.page1.getContent()[e]||[{text:"",style:{color:""}}],void 0,0);this.options.showTitle?this.CM.Screen.write({text:`${r.normal.left}${r.normal.horizontal}${o[1]}${r.normal.horizontal.repeat(this.CM.Screen.width-g(o[1])-3)}${r.normal.right}`,style:{color:this.options.boxColor,bold:this.boxBold}}):this.CM.Screen.write({text:`${r.normal.left}${r.normal.horizontal.repeat(this.CM.Screen.width-2)}${r.normal.right}`,style:{color:this.options.boxColor,bold:this.boxBold}});for(let e=0;e<t[1];e++)this.drawLine(this.page2.getContent()[e]||[{text:"",style:{color:""}}],void 0,1);this.CM.Screen.write({text:`${r.normal.bottomLeft}${r.normal.horizontal.repeat(this.CM.Screen.width-2)}${r.normal.bottomRight}`,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}})}else{this.options.showTitle&&this.CM.Screen.write({text:`${o[0]}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}});for(let e=0;e<t[0];e++)this.drawLine(this.page1.getContent()[e]||[{text:"",style:{color:""}}],void 0,0);this.options.showTitle&&this.CM.Screen.write({text:`${o[1]}`,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}});for(let e=0;e<t[1];e++)this.drawLine(this.page2.getContent()[e]||[{text:"",style:{color:""}}],void 0,1)}}else{this.realWidth=[Math.round(this.CM.Screen.width*this.proportions[0]),Math.round(this.CM.Screen.width*this.proportions[1])];let o=[x(this.page1Title,this.realWidth[0]-4,!1),x(this.page2Title,this.realWidth[1]-3,!1)],t=Math.max(this.page1.getViewedPageHeight(),this.page2.getViewedPageHeight());if(this.options.fitHeight){let s=this.options.boxed||this.options.showTitle?2:0;t=this.CM.Screen.height-s}let e=this.page1.getContent(),i=this.page2.getContent();if(this.options.boxed){this.options.showTitle?this.CM.Screen.write({text:`${r.normal.topLeft}${r.normal.horizontal}${o[0]}${r.normal.horizontal.repeat(this.realWidth[0]-g(o[0])-3)}${r.normal.top}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}},{text:`${r.normal.horizontal}${o[1]}${r.normal.horizontal.repeat(this.realWidth[1]-g(o[1])-2)}${r.normal.topRight}`,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}}):this.CM.Screen.write({text:`${r.normal.topLeft}${r.normal.horizontal}${r.normal.horizontal.repeat(this.realWidth[0]-3)}${r.normal.top}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}},{text:`${r.normal.horizontal}${r.normal.horizontal.repeat(this.realWidth[1]-2)}${r.normal.topRight}`,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}});for(let s=0;s<t;s++)this.drawLine(e[s]||[{text:"",style:{color:""}}],i[s]||[{text:"",style:{color:""}}]);this.CM.Screen.write({text:`${r.normal.bottomLeft}${r.normal.horizontal.repeat(this.realWidth[0]-2)}${r.normal.bottom}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}},{text:`${r.normal.horizontal.repeat(this.realWidth[1]-1)}${r.normal.bottomRight}`,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}})}else{this.options.showTitle&&this.CM.Screen.write({text:`${o[0]}${" ".repeat(this.realWidth[0]-g(o[0]))}${o[1]}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}});for(let s=0;s<t;s++)this.drawLine(e[s]||[{text:"",style:{color:""}}],i[s]||[{text:"",style:{color:""}}])}}}},Yt=mt;var xt=class{constructor(o,t,e,i,s,n=0){this.realWidth=[[0,0],[0,0]];this.CM=new y,this.options=s,this.selected=n,this.page1=o,this.page2=t,this.page3=e,this.page4=i,this.boxBold=this.options.boxStyle==="bold",this.proportions=this.options.pageRatio||[[.4,.6],[.5,.5]],this.page1Title=this.options.page1Title||"",this.page2Title=this.options.page2Title||"",this.page3Title=this.options.page3Title||"",this.page4Title=this.options.page4Title||""}setPage(o,t){switch(t){case 0:this.page1=o;break;case 1:this.page2=o;break;case 2:this.page3=o;break;case 3:this.page4=o;break;default:break}}setPage1(o){this.page1=o}setPage2(o){this.page2=o}setPage3(o){this.page3=o}setPage4(o){this.page4=o}setTitles(o){this.page1Title=o[0],this.page2Title=o[1],this.page3Title=o[2],this.page4Title=o[3]}setTitle(o,t){switch(t){case 0:this.page1Title=o;break;case 1:this.page2Title=o;break;case 2:this.page3Title=o;break;case 3:this.page4Title=o;break;default:break}}setBorder(o){this.options.boxed=o}setSelected(o){this.selected=o}getSelected(){return this.selected}changeLayout(){this.selected>=0&&this.selected<3?this.selected++:this.selected=0}setRatio(o){this.proportions=o}increaseRatio(o){this.selected<2?this.proportions[0][0]<.9&&(this.proportions[0][0]=Number((this.proportions[0][0]+o).toFixed(2)),this.proportions[0][1]=Number((this.proportions[0][1]-o).toFixed(2))):this.proportions[1][0]<.9&&(this.proportions[1][0]=Number((this.proportions[1][0]+o).toFixed(2)),this.proportions[1][1]=Number((this.proportions[1][1]-o).toFixed(2)))}decreaseRatio(o){this.selected<2?this.proportions[0][0]>.1&&(this.proportions[0][0]=Number((this.proportions[0][0]-o).toFixed(2)),this.proportions[0][1]=Number((this.proportions[0][1]+o).toFixed(2))):this.proportions[1][0]>.1&&(this.proportions[1][0]=Number((this.proportions[1][0]-o).toFixed(2)),this.proportions[1][1]=Number((this.proportions[1][1]+o).toFixed(2)))}drawLine(o,t,e=0){let i=this.options.boxed?3:0,s=[""],n=[[...o]];n=[[...o],[...t||o]],s.push(""),o.forEach(h=>{s[0]+=h.text}),t?.forEach(h=>{s[1]+=h.text}),s.filter((h,u)=>h.length>this.realWidth[e][u]-i).length>0&&(s=s.map((h,u)=>{if(h.length>this.realWidth[e][u]-i){n[u]=JSON.parse(JSON.stringify(u===0?o:t));let c=h.length-this.realWidth[e][u]+1;for(let p=n[u].length-1;p>=0;p--)if(n[u][p].text.length>c+2){n[u][p].text=x(n[u][p].text,n[u][p].text.length-c-2,!1);break}else c-=n[u][p].text.length,n[u].splice(p,1);return n[u].map(p=>p.text).join("")}return h}));let l=[];this.options.boxed&&l.push({text:r.normal.vertical,style:{color:this.selected===0&&e===0||this.selected===2&&e===1?this.options.boxColor:"white",bold:this.boxBold}}),l.push(...n[0]),s[0].length<=this.realWidth[e][0]-i&&l.push({text:`${" ".repeat(this.realWidth[e][0]-s[0].length-(i>0?2:0))}`,style:{color:""}}),this.options.boxed&&l.push({text:r.normal.vertical,style:{color:this.selected<2&&e===0||this.selected>1&&e===1?this.options.boxColor:"white",bold:this.boxBold}}),l.push(...n[1]),s[1].length<=this.realWidth[e][1]-i&&l.push({text:`${" ".repeat(this.realWidth[e][1]-s[1].length-(i>0?1:0))}`,style:{color:""}}),this.options.boxed&&l.push({text:r.normal.vertical,style:{color:this.selected===1&&e===0||this.selected===3&&e===1?this.options.boxColor:"white",bold:this.boxBold}}),this.CM.Screen.write(...l)}draw(){this.isOdd=this.CM.Screen.width%2===1,this.realWidth=[[Math.round(this.CM.Screen.width*this.proportions[0][0]),Math.round(this.CM.Screen.width*this.proportions[0][1])],[Math.round(this.CM.Screen.width*this.proportions[1][0]),Math.round(this.CM.Screen.width*this.proportions[1][1])]];let o=[[x(this.page1Title,this.realWidth[0][0]-4,!1),x(this.page2Title,this.realWidth[0][1]-3,!1)],[x(this.page3Title,this.realWidth[1][0]-4,!1),x(this.page4Title,this.realWidth[1][1]-3,!1)]],t=Math.max(this.page1.getViewedPageHeight(),this.page2.getViewedPageHeight(),this.page3.getViewedPageHeight(),this.page4.getViewedPageHeight());if(this.options.fitHeight){let i=this.options.boxed||this.options.showTitle?4:0;t=(this.CM.Screen.height-i)/2}let e=[this.page1.getContent(),this.page2.getContent(),this.page3.getContent(),this.page4.getContent()];for(let i=0;i<2;i++)if(this.options.boxed){i===0&&(this.options.showTitle?this.CM.Screen.write({text:`${r.normal.topLeft}${r.normal.horizontal}${o[i][0]}${r.normal.horizontal.repeat(this.realWidth[i][0]-o[i][0].length-3)}${r.normal.top}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}},{text:`${r.normal.horizontal}${o[i][1]}${r.normal.horizontal.repeat(this.realWidth[i][1]-o[i][1].length-2)}${r.normal.topRight}`,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}}):this.CM.Screen.write({text:`${r.normal.topLeft}${r.normal.horizontal}${r.normal.horizontal.repeat(this.realWidth[i][0]-3)}${r.normal.top}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}},{text:`${r.normal.horizontal}${r.normal.horizontal.repeat(this.realWidth[i][1]-2)}${r.normal.topRight}`,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}}));for(let s=0;s<t;s++)this.drawLine(e[i+i*1][s]||[{text:"",style:{color:""}}],e[i+i*1+1][s]||[{text:"",style:{color:""}}],i);if(i===0){let s=this.realWidth[i][0],n=this.realWidth[i+1][0];if(this.options.showTitle){let l;s===n&&(l=`${r.normal.horizontal.repeat(s-o[i+1][0].length-3)}${r.normal.cross}`),s>n&&(l=`${r.normal.horizontal.repeat(n-o[i+1][0].length-3)}${r.normal.top}`),s<n&&o[i+1][0].length<s-2&&(l=`${r.normal.horizontal.repeat(s-o[i+1][0].length-3)}${r.normal.bottom}${r.normal.horizontal.repeat(n-s-1)}${r.normal.top}`),s<n&&o[i+1][0].length>=s-2&&(l=`${r.normal.horizontal.repeat(n-o[i+1][0].length-3)}${r.normal.top}`);let h;(s===n||s<n)&&(h=`${r.normal.horizontal.repeat(this.realWidth[i+1][1]-o[i+1][1].length-2)}`),s>n&&(s-n>=o[i+1][1].length+2?h=`${r.normal.horizontal.repeat(s-n-(o[i+1][1].length+2))}${r.normal.bottom}${r.normal.horizontal.repeat(this.realWidth[i][1]-1)}`:h=`${r.normal.horizontal.repeat(this.realWidth[i+1][1]-(o[i+1][1].length+2))}`),this.CM.Screen.write({text:`${r.normal.left}${r.normal.horizontal}${o[i+1][0]}${l}`,style:{color:this.selected===2?this.options.boxColor:"white",bold:this.boxBold}},{text:`${r.normal.horizontal}${o[i+1][1]}${h}${r.normal.right}`,style:{color:this.selected===3?this.options.boxColor:"white",bold:this.boxBold}})}else{let l;s===n&&(l=`${r.normal.horizontal.repeat(s-2)}${r.normal.cross}`),s>n&&(l=`${r.normal.horizontal.repeat(n-2)}${r.normal.top}`),s<n&&(l=`${r.normal.horizontal.repeat(s-2)}${r.normal.bottom}${r.normal.horizontal.repeat(n-s-1)}${r.normal.top}`);let h;s<=n&&(h=`${r.normal.horizontal.repeat(this.realWidth[i+1][1]-1)}`),s>n&&(h=`${r.normal.horizontal.repeat(s-n-1)}${r.normal.bottom}${r.normal.horizontal.repeat(this.realWidth[i][1]-1)}`),this.CM.Screen.write({text:`${r.normal.left}${l}`,style:{color:this.selected===0||this.selected===2?this.options.boxColor:"white",bold:this.boxBold}},{text:`${h}${r.normal.right}`,style:{color:this.selected===1||this.selected===3?this.options.boxColor:"white",bold:this.boxBold}})}}else this.CM.Screen.write({text:`${r.normal.bottomLeft}${r.normal.horizontal.repeat(this.realWidth[i][0]-2)}${r.normal.bottom}`,style:{color:this.selected===2?this.options.boxColor:"white",bold:this.boxBold}},{text:`${r.normal.horizontal.repeat(this.realWidth[i][1]-1)}${r.normal.bottomRight}`,style:{color:this.selected===3?this.options.boxColor:"white",bold:this.boxBold}})}else{this.options.showTitle&&(i===0?this.CM.Screen.write({text:`${o[i][0]}${" ".repeat(this.realWidth[i][0]-o[i][0].length)}`,style:{color:this.selected===0?this.options.boxColor:"white",bold:this.boxBold}},{text:`${o[i][1]}`,style:{color:this.selected===1?this.options.boxColor:"white",bold:this.boxBold}}):this.CM.Screen.write({text:`${o[i][0]}${" ".repeat(this.realWidth[i][0]-o[i][0].length)}`,style:{color:this.selected===2?this.options.boxColor:"white",bold:this.boxBold}},{text:`${o[i][1]}`,style:{color:this.selected===3?this.options.boxColor:"white",bold:this.boxBold}}));for(let s=0;s<t;s++)this.drawLine(e[i+i*1][s]||[{text:"",style:{color:""}}],e[i+i*1+1][s]||[{text:"",style:{color:""}}],i)}}},qt=xt;var yt=class{constructor(o,t){this.CM=new y,this.options=t,this.page=o,this.boxBold=this.options.boxStyle==="bold",this.pageTitle=this.options.pageTitle||this.CM.applicationTitle}setPage(o){this.page=o}setTitle(o){this.pageTitle=o}setBorder(o){this.options.boxed=o}drawLine(o){let t=this.options.boxed?2:0,e="",i=[...o];if(o.forEach(s=>{e+=s.text}),e.length>this.CM.Screen.width-t){i=[...JSON.parse(JSON.stringify(o))];let n=e.length-this.CM.Screen.width+1;for(let l=i.length-1;l>=0;l--)if(i[l].text.length>n+2){i[l].text=x(i[l].text,i[l].text.length-n-2,!0);break}else n-=i[l].text.length,i.splice(l,1);e=i.map(l=>l.text).join("")}this.options.boxed&&i.unshift({text:r.normal.vertical,style:{color:this.options.boxColor,bold:this.boxBold}}),e.length<=this.CM.Screen.width-t&&i.push({text:`${" ".repeat(this.CM.Screen.width-e.length-t)}`,style:{color:""}}),this.options.boxed&&i.push({text:r.normal.vertical,style:{color:this.options.boxColor,bold:this.boxBold}}),this.CM.Screen.write(...i)}draw(){this.isOdd=this.CM.Screen.width%2===1;let o=x(this.pageTitle,this.CM.Screen.width-2,!1);if(this.options.boxed){if(this.options.showTitle?this.CM.Screen.write({text:`${r.normal.topLeft}${r.normal.horizontal}${o}${r.normal.horizontal.repeat(this.CM.Screen.width-o.length-3)}${r.normal.topRight}`,style:{color:this.options.boxColor,bold:this.boxBold}}):this.CM.Screen.write({text:`${r.normal.topLeft}${r.normal.horizontal}${r.normal.horizontal.repeat(this.CM.Screen.width-3)}${r.normal.topRight}`,style:{color:this.options.boxColor,bold:this.boxBold}}),this.options.fitHeight)for(let t=0;t<this.CM.Screen.height-2;t++)this.drawLine(this.page.getContent()[t]||[{text:"",style:{color:""}}]);else this.page.getContent().forEach(t=>{this.drawLine(t)});this.CM.Screen.write({text:`${r.normal.bottomLeft}${r.normal.horizontal.repeat(this.CM.Screen.width-2)}${r.normal.bottomRight}`,style:{color:this.options.boxColor,bold:this.boxBold}})}else if(this.options.showTitle&&this.CM.Screen.write({text:`${o}`,style:{color:this.options.boxColor,bold:this.boxBold}}),this.options.fitHeight)for(let t=0;t<this.CM.Screen.height-2;t++)this.drawLine(this.page.getContent()[t]||[{text:"",style:{color:""}}]);else this.page.getContent().forEach(t=>{this.drawLine(t)})}},Ct=yt;var St=class{constructor(o,t){this.pages={};this.pageTitles=[];this.isSingleLayout=o=>o instanceof Ct;if(this.instance)return this.instance;switch(this.instance=this,this.CM=new y,this.options=t,o.forEach((e,i)=>{this.pages[i]=e}),this.pageTitles=this.options.pageTitles||[this.CM.applicationTitle],this.options.type){case"single":this.optionsRelative={showTitle:this.options.showTitle,boxed:this.options.boxed,boxColor:this.options.boxColor,boxStyle:this.options.boxStyle,pageTitle:this.pageTitles?this.pageTitles[0]:"",fitHeight:this.options.fitHeight},this.layout=new Ct(this.pages[0],this.optionsRelative);break;case"double":this.optionsRelative={showTitle:this.options.showTitle,boxed:this.options.boxed,boxColor:this.options.boxColor,boxStyle:this.options.boxStyle,changeFocusKey:this.options.changeFocusKey||"",direction:this.options.direction,page1Title:this.pageTitles?this.pageTitles[0]:"",page2Title:this.pageTitles?this.pageTitles[1]:"",pageRatio:this.options.pageRatio,fitHeight:this.options.fitHeight},this.layout=new Yt(this.pages[0],this.pages[1],this.optionsRelative);break;case"triple":break;case"quad":this.optionsRelative={showTitle:this.options.showTitle,boxed:this.options.boxed,boxColor:this.options.boxColor,boxStyle:this.options.boxStyle,changeFocusKey:this.options.changeFocusKey||"",direction:this.options.direction,page1Title:this.pageTitles?this.pageTitles[0]:"",page2Title:this.pageTitles?this.pageTitles[1]:"",page3Title:this.pageTitles?this.pageTitles[2]:"",page4Title:this.pageTitles?this.pageTitles[3]:"",pageRatio:this.options.pageRatio,fitHeight:this.options.fitHeight},this.layout=new qt(this.pages[0],this.pages[1],this.pages[2],this.pages[3],this.optionsRelative);break;default:break}}setPages(o){o.forEach((t,e)=>{this.pages[e]=t,this.isSingleLayout(this.layout)?this.layout.setPage(t):this.layout.setPage(t,e)})}setPage(o,t){this.pages[t]=o,this.isSingleLayout(this.layout)?this.layout.setPage(o):this.layout.setPage(o,t)}setTitle(o,t){this.pageTitles[t]=o,this.isSingleLayout(this.layout)?this.layout.setTitle(o):this.layout.setTitle(o,t)}setTitles(o){this.pageTitles=o,this.isSingleLayout(this.layout)?this.layout.setTitle(o[0]):this.layout.setTitles(o)}setBorder(o){this.options.boxed=o}setSelected(o){this.isSingleLayout(this.layout)||this.layout.setSelected(o)}getSelected(){return this.isSingleLayout(this.layout)?0:this.layout.selected}changeLayout(){this.isSingleLayout(this.layout)||this.layout.changeLayout()}decreaseRatio(o){this.isSingleLayout(this.layout)||this.layout.decreaseRatio(o)}increaseRatio(o){this.isSingleLayout(this.layout)||this.layout.increaseRatio(o)}draw(){this.layout.draw()}},Jt=St;var Qt=require("events"),ot=class extends Qt.EventEmitter{constructor(t,e){super();this.keymap={MOUSE:[{code:"\x1B[<",event:"mouse",handler:"mouseSGRProtocol"},{code:"\x1B[M",event:"mouse",handler:"mouseX11Protocol"}]};this.state={button:{left:null,middle:null,right:null,other:null}};this.mouseX11Protocol=(t,e)=>{let i=e[0],s={data:{shift:!!(i&4),alt:!!(i&8),ctrl:!!(i&16),x:0,y:0,code:0},name:"",eaten:0};if(i&32)if(i&64)s.name=t+(i&1?"_WHEEL_DOWN":"_WHEEL_UP");else switch(i&3){case 0:s.name=t+"_LEFT_BUTTON_PRESSED";break;case 1:s.name=t+"_MIDDLE_BUTTON_PRESSED";break;case 2:s.name=t+"_RIGHT_BUTTON_PRESSED";break;case 3:s.name=t+"_BUTTON_RELEASED";break}else i&64&&(s.name=t+"_MOTION");return s.eaten=3,s.data.code=i,s.data.x=e[1]-32,s.data.y=e[2]-32,s};this.mouseSGRProtocol=(t,e)=>{let i=e.toString().match(/^(-?[0-9]*);?([0-9]*);?([0-9]*)(M|m)/);if(!i||i[3].length===0)return{name:"ERROR",eaten:i?i[0].length:0,data:{matches:i}};let s=parseInt(i[1],10),n=i[4]!=="m",l={data:{shift:!!(s&4),alt:!!(s&8),ctrl:!!(s&16),x:0,y:0,code:0,left:!1,right:!1,xFrom:null,yFrom:null},name:"",eaten:0};if(l.data.x=parseInt(i[2],10),l.data.y=parseInt(i[3],10),l.eaten=i[0].length,s&32)switch(s&3){case 0:l.name=t+"_DRAG",l.data.left=!0,l.data.right=!1,l.data.xFrom=this.state.button.left?this.state.button.left.x:null,l.data.yFrom=this.state.button.left?this.state.button.left.y:null;break;case 2:l.name=t+"_DRAG",l.data.left=!1,l.data.right=!0,l.data.xFrom=this.state.button.right?this.state.button.right.x:null,l.data.yFrom=this.state.button.right?this.state.button.right.y:null;break;case 3:default:l.name=t+"_MOTION";break}else if(s&64)l.name=t+(s&1?"_WHEEL_DOWN":"_WHEEL_UP");else{switch(s&3){case 0:l.name=t+"_LEFT_BUTTON",this.state.button.left=n?l.data:null;break;case 1:l.name=t+"_MIDDLE_BUTTON",this.state.button.middle=n?l.data:null;break;case 2:l.name=t+"_RIGHT_BUTTON",this.state.button.right=n?l.data:null;break;case 3:l.name=t+"_OTHER_BUTTON",this.state.button.other=n?l.data:null;break}l.name+=n?"_PRESSED":"_RELEASED"}return l.data.code=s,l};this.onStdin=t=>{let e,i,s,n=0,l=t.length;for(this.prependStdinChunk&&(t=Buffer.concat([this.prependStdinChunk,t]));n<l;){if(i=1,t[n]<=31||t[n]===127){let u=t.subarray(n,3).toString(),d=this.keymap.MOUSE.filter(function(c){return c.code===u});d.length>0&&d[0].handler&&(s=this[d[0].handler].call(this,"MOUSE",t.subarray(n+3)),i=e+s.eaten,s.disable||this.emit("mouseevent",s))}n+=i}};this.Terminal=t,this.Input=e,this.prependStdinChunk=null}enableMouse(){process.on("exit",()=>{this.disableMouse()}),this.Terminal.write("\x1B[?1006h"),this.Terminal.write("\x1B[?1003h"),this.Input.on("data",this.onStdin)}disableMouse(){this.Input.removeListener("data",this.onStdin),this.Terminal.write("\x1B[?1006l"),this.Terminal.write("\x1B[?1003l")}isMouseFrame(t,e){return t.code&&this.keymap.MOUSE.filter(i=>i.code===t.sequence).length>0?1:e?t.sequence.toLowerCase()==="m"?-1:1:0}};var f=require("os"),y=class extends Zt.EventEmitter{constructor(t=void 0){super();this.popupCollection={};this.controlsCollection={};this.eventListenersContainer={};this.parsingMouseFrame=!1;this.previousFocusedWidgetsId=[];return this.Terminal=process.stdout,this.Input=process.stdin,y.instance||(y.instance=this,this.Screen=new Wt(this.Terminal),this.Screen.on("resize",()=>{this.emit("resize")}),this.Screen.on("error",e=>{this.error(e)}),this.mouse=new ot(this.Terminal,this.Input),this.popupCollection={},this.controlsCollection={},this.eventListenersContainer={},this.logLocation=1,this.logPageTitle="LOGS",this.layoutOptions={showTitle:!0,boxed:!0,boxColor:"cyan",boxStyle:"bold",changeFocusKey:"ctrl+l",type:"double",direction:"vertical"},t&&(t.logLocation!==void 0&&(typeof t.logLocation=="number"?this.logLocation=t.logLocation>0?t.logLocation:0:t.logLocation==="popup"?(this.logLocation="popup",this.showLogKey=t.showLogKey||"o"):this.logLocation=1),t.enableMouse&&this.mouse.enableMouse(),t.overrideConsole?t.overrideConsole===!0&&this.overrideConsole():this.overrideConsole(),typeof t.layoutOptions<"u"&&this.setLayoutOptions(t.layoutOptions,!1)),this.logPageSize=t&&t.logPageSize||10,this.applicationTitle=t&&t.title||"",this.focusKey=t&&t.focusKey||"tab",this.stdOut=new T,this.stdOut.setRowsPerPage(this.logPageSize),this.updateLayout(),this.addGenericListeners(),te.default.emitKeypressEvents(this.Input),this.Input.setRawMode(!0)),y.instance}setLayoutOptions(t,e=!0){this.layoutOptions=t,e&&this.updateLayout()}updateLayout(){switch(this.changeLayoutKey=this.layoutOptions.changeFocusKey||"",this.changeLayoutkeys=this.changeLayoutKey?this.changeLayoutKey.split("+"):[],this.layoutOptions.type){case"single":this.pages=[new T];break;case"double":this.pages=[new T,new T];break;case"triple":this.pages=[new T,new T,new T];break;case"quad":this.pages=[new T,new T,new T,new T];break;default:this.pages=[new T,new T];break}this.layout=new Jt(this.pages,this.layoutOptions),this.logLocation==="popup"?this.setPages(this.pages):typeof this.logLocation=="number"?(this.setPage(this.stdOut,this.logLocation),this.pages.forEach((t,e)=>{e!==this.logLocation&&this.setPage(t,e)}),this.layout.setTitle(this.logPageTitle,this.logLocation)):(this.setPages([...this.pages,this.stdOut]),this.layout.setTitle(this.applicationTitle,0),this.layout.setTitle(this.logPageTitle,1))}getLayoutOptions(){return this.layoutOptions}getLogPageSize(){return this.logPageSize}setLogPageSize(t){this.logPageSize=t}unfocusOtherWidgets(t){Object.keys(this.controlsCollection).forEach(e=>{e!==t&&(this.controlsCollection[e].unfocus(),this.previousFocusedWidgetsId.push(e))}),Object.keys(this.popupCollection).forEach(e=>{e!==t&&(this.popupCollection[e].unfocus&&this.popupCollection[e].unfocus(),this.previousFocusedWidgetsId.push(e))})}restoreFocusInWidgets(){this.previousFocusedWidgetsId.forEach(t=>{this.controlsCollection[t]?this.controlsCollection[t].focus():this.popupCollection[t]&&this.popupCollection[t].focus&&this.popupCollection[t].focus()}),this.previousFocusedWidgetsId=[]}addGenericListeners(){this.Input.addListener("keypress",(t,e)=>{let i=this.mouse.isMouseFrame(e,this.parsingMouseFrame);if(i===1){this.parsingMouseFrame=!0;return}else if(i===-1){this.parsingMouseFrame=!1;return}let s=!1;if(this.changeLayoutkeys.length>1?(this.changeLayoutkeys[0]=="ctrl"&&e.ctrl&&e.name===this.changeLayoutkeys[1]&&(s=!0),this.changeLayoutkeys[0]=="meta"&&e.alt&&e.name===this.changeLayoutkeys[1]&&(s=!0),this.changeLayoutkeys[0]=="shift"&&e.shift&&e.name===this.changeLayoutkeys[1]&&(s=!0)):e.name===this.changeLayoutkeys[0]&&(s=!0),this.focusKey&&e.name===this.focusKey){let n="";Object.keys(this.controlsCollection).forEach(h=>{this.controlsCollection[h].isFocused()&&(n=h)}),n!==""&&this.controlsCollection[n].unfocus();let l=!1;Object.keys(this.controlsCollection).forEach(h=>{l&&(this.controlsCollection[h].focus(),l=!1),h===n&&(l=!0)}),l&&this.controlsCollection[Object.keys(this.controlsCollection)[0]].focus()}if(this.showLogKey&&e.name===this.showLogKey&&this.showLogPopup(),s){this.layout.changeLayout(),this.refresh();return}if(e.ctrl&&e.name==="c")this.emit("exit");else if(Object.keys(this.popupCollection).length===0){if(e.name==="down"){this.layout.pages[this.layout.getSelected()].decreaseScrollIndex(),this.refresh();return}else if(e.name==="up"){this.layout.pages[this.layout.getSelected()].increaseScrollIndex(),this.refresh();return}if(this.layoutOptions.type!=="single"){if(e.name==="left"){this.emit("layoutratiochanged",e),this.layout.decreaseRatio(.01),this.refresh();return}else if(e.name==="right"){this.emit("layoutratiochanged",e),this.layout.increaseRatio(.01),this.refresh();return}}this.emit("keypressed",e)}}),this.mouse.addListener("mouseevent",t=>{t.name==="MOUSE_LEFT_BUTTON_PRESSED"&&Object.keys(this.controlsCollection).forEach(e=>{this.controlsCollection[e].absoluteValues.x<=t.data.x&&this.controlsCollection[e].absoluteValues.x+this.controlsCollection[e].absoluteValues.width>=t.data.x&&this.controlsCollection[e].absoluteValues.y<=t.data.y&&this.controlsCollection[e].absoluteValues.y+this.controlsCollection[e].absoluteValues.height>=t.data.y&&(this.controlsCollection[e].isFocused()||this.controlsCollection[e].focus())})})}setKeyListener(t,e){this.eventListenersContainer[t]!==void 0&&this.removeKeyListener(t),this.eventListenersContainer[t]=e,this.Input.addListener("keypress",this.eventListenersContainer[t])}removeKeyListener(t){this.Input.removeListener("keypress",this.eventListenersContainer[t]),delete this.eventListenersContainer[t]}setMouseListener(t,e){this.eventListenersContainer[t]!==void 0&&this.removeMouseListener(t),this.eventListenersContainer[t]=e,this.mouse.addListener("mouseevent",this.eventListenersContainer[t])}removeMouseListener(t){this.mouse.removeListener("mouseevent",this.eventListenersContainer[t]),delete this.eventListenersContainer[t]}registerPopup(t){this.popupCollection[t.id]=t}unregisterPopup(t){this.popupCollection[t.id]&&delete this.popupCollection[t.id]}registerControl(t){this.controlsCollection[t.id]=t}unregisterControl(t){this.controlsCollection[t.id]&&delete this.controlsCollection[t.id]}setHomePage(t){this.pages[0]=t,this.logLocation==="popup"?this.layout.setPage(t,0):typeof this.logLocation=="number"?this.logLocation===0?this.layout.setPage(t,1):this.layout.setPage(t,0):this.layout.setPage(t,1),this.refresh()}setPage(t,e=0,i=null){this.pages[e]=t,typeof this.logLocation=="number"&&this.logLocation===e&&(this.pages[this.logLocation]=this.stdOut),this.layout.setPage(this.pages[e],e),i&&this.layout.setTitle(i,e),this.refresh()}setPages(t,e=null){t.forEach((i,s)=>{typeof this.logLocation=="number"&&this.logLocation===s||(this.pages[s]=i)}),this.layout.setPages(this.pages),e&&this.layout.setTitles(e),this.refresh()}refresh(){this.Screen.update(),this.layout.draw();for(let t in this.controlsCollection)this.controlsCollection[t].isVisible()&&this.controlsCollection[t].draw();for(let t in this.popupCollection)this.popupCollection[t].isVisible()&&this.popupCollection[t].draw();this.Screen.print()}showLogPopup(){return new H({id:"logPopup",title:"Application Logs",content:this.stdOut,width:this.Screen.width-12}).show()}log(t){this.stdOut.addRow({text:t,color:"white"}),this.updateLogsConsole(!0)}error(t){this.stdOut.addRow({text:t,color:"red"}),this.updateLogsConsole(!0)}warn(t){this.stdOut.addRow({text:t,color:"yellow"}),this.updateLogsConsole(!0)}info(t){this.stdOut.addRow({text:t,color:"blue"}),this.updateLogsConsole(!0)}updateLogsConsole(t){t&&this.stdOut.setScrollIndex(0),this.refresh()}overrideConsole(){console.log=t=>{this.log(t)},console.error=t=>{this.error(t)},console.warn=t=>{this.warn(t)},console.info=t=>{this.info(t)},console.debug=t=>{this.log(t)}}};0&&(module.exports={Box,Button,ButtonPopup,ConfirmPopup,ConsoleManager,Control,CustomPopup,EOL,FileSelectorPopup,InPageWidgetBuilder,InputPopup,OptionPopup,PageBuilder,Progress});
//# sourceMappingURL=ConsoleGui.cjs.map
